ä½ è¯´çš„è¿™ä¸¤ç±»ï¼Œæ ¸å¿ƒå·®åˆ«åœ¨**å»ºæ¨¡è¡¨ç¤º**ï¼š

- **Token-free / è¿ç»­å£°å­¦å»ºæ¨¡**ï¼ˆå¸¸è§æ˜¯ç›´æ¥å›å½’ mel/ç‰¹å¾ã€æˆ–è¿ç»­æµ/æ‰©æ•£/å›å½’å¼å£°å­¦ï¼‰ï¼šVoxCPMã€IndexTTS æ›´åè¿™ä¸€è·¯ï¼ˆè‡³å°‘ä½¿ç”¨ä¸Šå‘ˆç°ä¸ºâ€œä¸å…ˆç¦»æ•£åŒ–æˆè¯­éŸ³ token å†ç”Ÿæˆâ€ï¼‰ã€‚
    
- **Token-based / ç¦»æ•£è¯­éŸ³ token å»ºæ¨¡**ï¼ˆå…ˆæŠŠè¯­éŸ³å‹æˆç¦»æ•£ç æœ¬ tokenï¼Œå†åƒè¯­è¨€æ¨¡å‹ä¸€æ ·ç”Ÿæˆ tokenï¼Œæœ€åè§£ç æˆéŸ³é¢‘ï¼‰ï¼šXTTSã€CosyVoiceï¼ˆå«ä¸€äº›å˜ä½“ï¼‰æ›´å¸¸è§åœ¨è¿™ä¸€è·¯ã€‚
    

ä¸‹é¢æŒ‰â€œä¼˜åŠ¿ / ç¼ºç‚¹ / å–èˆ / æ“…é•¿åœºæ™¯â€ç»™ä½ ä¸€ä¸ªå®ç”¨å¯¹æ¯”ï¼ˆåå‘ä½ å…³å¿ƒçš„ï¼š**æœ‰å£°ä¹¦ + å£°éŸ³å…‹éš† + ç¦»çº¿**ï¼‰ã€‚

---

## Token-freeï¼ˆVoxCPM / IndexTTS è¿™ç±»ï¼‰å¸¸è§ä¼˜åŠ¿

1. **éŸ³è‰²ç»†èŠ‚æ›´å®¹æ˜“â€œä¿çœŸâ€**  
    è¿ç»­ç‰¹å¾å¯¹ç»†å¾®çš„å…±æŒ¯å³°ã€æ°”å£°ã€å£å‹å˜åŒ–æ›´æ•æ„Ÿï¼ŒçŸ­æ ·æœ¬å…‹éš†æ—¶æ›´å¯èƒ½ä¿ç•™â€œåƒæœ¬äººâ€çš„è´¨æ„Ÿï¼ˆå°¤å…¶ä¸­æ–‡é‡Œä¸€äº›éŸµæ¯/å„¿åŒ–/è½»å£°çš„ç»†èŠ‚ï¼‰ã€‚
    
2. **æ›´ä¸å®¹æ˜“å‡ºç°â€œtoken é‡åŒ–å‘³/ç æœ¬å‘³â€**  
    Token-based é‡Œç æœ¬å®¹é‡æˆ–è®­ç»ƒåŸŸä¸å¤Ÿæ—¶ï¼Œå®¹æ˜“å¬å‡ºä¸€ç§â€œç»Ÿä¸€çš„åˆæˆè´¨æ„Ÿâ€ã€‚è¿ç»­å»ºæ¨¡æœ‰æ—¶èƒ½æ›´è‡ªç„¶åœ°è¿‡æ¸¡ã€‚
    
3. **é•¿å¥çš„éŸµå¾‹æ›´å¹³æ»‘**ï¼ˆåœ¨è°ƒå¾—å¥½çš„å‰æä¸‹ï¼‰  
    è¿ç»­ç”Ÿæˆçš„æ›²çº¿æ›´å®¹æ˜“åšå¹³æ»‘æ§åˆ¶ï¼Œä¸é‚£ä¹ˆâ€œå—çŠ¶â€ã€‚
    

### Token-free å¸¸è§ç¼ºç‚¹

1. **æ¨ç†ç®—åŠ›æ›´åƒç´§**ï¼ˆå°¤å…¶æ‰©æ•£/æµå¼ç±»ï¼‰  
    CPU/MPS ä¸Šæ›´å¯èƒ½æ…¢ï¼›è¦åšâ€œæœ‰å£°ä¹¦æ‰¹é‡ç”Ÿæˆâ€ä¼šæ›´ç—›è‹¦ï¼Œé™¤éåšäº†å¾ˆå¼ºçš„åŠ é€Ÿ/è’¸é¦/é‡åŒ–ã€‚
    
2. **å¯æ§æ€§/å¯ç¼–è¾‘æ€§æœ‰æ—¶ä¸å¦‚ token-based å·¥ç¨‹æˆç†Ÿ**  
    æ¯”å¦‚å¼ºåˆ¶å¯¹é½ã€æ’å…¥åœé¡¿ã€å­—çº§æ—¶é•¿æ§åˆ¶ã€å¯è§£é‡Šçš„ prosody token ç­‰ï¼Œtoken-based å¾€å¾€æ›´å®¹æ˜“åšæˆâ€œå¯æ§å·¥å…·é“¾â€ã€‚
    
3. **ç¨³å®šæ€§ä¾èµ–å®ç°**  
    åŒæ ·å«â€œtoken-freeâ€ï¼Œä¸åŒé¡¹ç›®çš„å¯¹é½ã€å‰ç«¯ï¼ˆG2P/åˆ†è¯/æ ‡ç‚¹å¤„ç†ï¼‰ã€å£°å­¦åå¤„ç†å·®åˆ«å¾ˆå¤§ï¼›æœ‰çš„ä¼šæ›´å®¹æ˜“å‡ºç°çˆ†éŸ³ã€åå­—ã€å°¾éŸ³æ–­è£‚ç­‰å·¥ç¨‹é—®é¢˜ã€‚
    

---

## Token-basedï¼ˆXTTS / CosyVoice è¿™ç±»ï¼‰å¸¸è§ä¼˜åŠ¿

1. **é€Ÿåº¦ä¸å¯éƒ¨ç½²æ€§é€šå¸¸æ›´å¥½**  
    ä¸€æ—¦å˜æˆ token ç”Ÿæˆ + è§£ç å™¨ï¼Œæ¨ç†è·¯å¾„æ›´åƒâ€œLLM + codec è§£ç â€ï¼Œæ›´å®¹æ˜“åšæµå¼ã€æ‰¹é‡ã€é‡åŒ–ã€è·¨å¹³å°éƒ¨ç½²ã€‚
    
2. **å¯æ§èƒ½åŠ›æ›´å®¹æ˜“åšå¼º**  
    ä¾‹å¦‚ï¼šæƒ…ç»ª/è¯­é€Ÿ/é£æ ¼æç¤ºã€è¯´è¯äºº embedding ç»„åˆã€ç”šè‡³ä¸€äº›æ¨¡å‹æ”¯æŒæ›´æ˜¾å¼çš„ prosody/style tokenï¼Œå·¥ç¨‹ä¸Šæ›´å®¹æ˜“åŠ â€œæ—‹é’®â€ã€‚
    
3. **é²æ£’æ€§æ›´å¥½**ï¼ˆå¾ˆå¤šæˆç†Ÿæ–¹æ¡ˆï¼‰  
    å¯¹è¾“å…¥æ–‡æœ¬å™ªå£°ï¼ˆå¥‡æ€ªæ ‡ç‚¹ã€æ•°å­—æ··æ’ã€ä¸­è‹±å¤¹æ‚ï¼‰çš„å®¹é”™å¾€å¾€æ›´é«˜ï¼Œé•¿æ–‡æœ¬æ›´ä¸å®¹æ˜“å´©ã€‚
    

### Token-based å¸¸è§ç¼ºç‚¹

1. **â€œåƒæœ¬äººâ€çš„ä¸Šé™æœ‰æ—¶å—ç æœ¬/è®­ç»ƒåŸŸé™åˆ¶**  
    å£°éŸ³ä¼šæ›´â€œåƒæŸä¸ªè®­ç»ƒåˆ†å¸ƒä¸­çš„ TTS å£°çº¿â€ï¼Œè€Œä¸æ˜¯ä½  sample çš„é‚£ä¸ªäººï¼›å°¤å…¶çŸ­æ ·æœ¬æ—¶ï¼Œå®¹æ˜“â€œæŠ“åˆ°éŸ³è‰²è½®å»“ä½†ç»†èŠ‚ä¸¢å¤±â€ã€‚
    
2. **å¯èƒ½å‡ºç°ç¦»æ•£åŒ–å¸¦æ¥çš„ä¼ªå½±**  
    å¬èµ·æ¥ä¼šæœ‰è½»å¾®é¢—ç²’æ„Ÿã€é‡‘å±æ„Ÿã€æˆ–æŸäº›éŸ³ç´ è¾¹ç•Œä¸å¤Ÿè‡ªç„¶ï¼ˆå–å†³äº codec è´¨é‡ä¸è®­ç»ƒï¼‰ã€‚
    
3. **é•¿ä¹¦å®¹æ˜“â€œé£æ ¼æ¼‚ç§»â€**  
    ç”Ÿæˆå¾ˆé•¿æ—¶ï¼ŒéŸ³è‰²æˆ–æƒ…ç»ªå¯èƒ½æ…¢æ…¢è·‘æ‰ï¼Œéœ€è¦åˆ†æ®µé‡ç½® speaker/style æ¡ä»¶ã€æˆ–åšæ›´å¼ºçš„ä¸€è‡´æ€§çº¦æŸã€‚
    

---

## é€‰å‹å–èˆ

- **ä½ æœ€åœ¨ä¹ï¼šåƒåŸå£° + æƒ…ç»ªç»†èŠ‚ + ä¸­æ–‡å’¬å­—è‡ªç„¶**  
    â†’ æ›´åå‘ **Token-free** è·¯çº¿ï¼ˆæˆ–è‡³å°‘æ˜¯â€œè¿ç»­å£°å­¦æ›´å¼ºâ€çš„æ–¹æ¡ˆï¼‰ã€‚ä»£ä»·æ˜¯ï¼š**æ›´æ…¢ã€æ›´åƒç®—åŠ›ã€å·¥ç¨‹è°ƒå‚æ›´è´¹æ—¶é—´**ã€‚
    
- **ä½ æœ€åœ¨ä¹ï¼šç¨³å®šæ‰¹é‡äº§å‡º + è·¨å¹³å°ï¼ˆCPU/MPS/CUDAï¼‰æ•ˆç‡ + å¯æ§æ€§**  
    â†’ æ›´åå‘ **Token-based** è·¯çº¿ã€‚ä»£ä»·æ˜¯ï¼š**å…‹éš†ä¸Šé™å¯èƒ½æ²¡é‚£ä¹ˆâ€œçœŸäººæ„Ÿâ€**ï¼Œå°¤å…¶åœ¨çŸ­æ ·æœ¬/å¤æ‚æƒ…ç»ªä¸‹ã€‚
    

---

## ä¸¤ç§å„è‡ªæœ€æ“…é•¿çš„åœºæ™¯

**Token-free æ›´æ“…é•¿ï¼š**

- 10â€“60 ç§’æ ·æœ¬çš„â€œé«˜ä¿çœŸå£°çº¹å…‹éš†â€ï¼ˆè¿½æ±‚åƒæœ¬äººï¼‰
    
- æƒ…ç»ªç»†èŠ‚ã€æ°”æ¯ã€å¾®å°è¯­è°ƒå˜åŒ–ï¼ˆæ›´åƒçœŸäººå½•éŸ³ï¼‰
    
- ä½ æ„¿æ„ç‰ºç‰²é€Ÿåº¦ï¼Œæ¢éŸ³è´¨ä¸Šé™
    

**Token-based æ›´æ“…é•¿ï¼š**

- æœ‰å£°ä¹¦é•¿ç¯‡æ‰¹é‡ç”Ÿæˆï¼ˆç¨³å®šã€å¿«ã€æ˜“å¹¶è¡Œï¼‰
    
- éœ€è¦å¾ˆå¤šâ€œæ§åˆ¶æ—‹é’®â€ï¼ˆè¯­é€Ÿã€é£æ ¼ã€æƒ…ç»ªã€åœé¡¿ï¼‰
    
- éœ€è¦åœ¨ CPU/MPS ä¸Šä¹Ÿèƒ½æ¯”è¾ƒèˆ’æœåœ°è·‘
    

---

å¦‚æœä½ å‘Šè¯‰æˆ‘ï¼š**ä½ ç°åœ¨ä¸»è¦è·‘åœ¨ CPU è¿˜æ˜¯ M3/MPSï¼Œæ ·æœ¬æ—¶é•¿é€šå¸¸å¤šå°‘ç§’ï¼Œä½ å¯¹é€Ÿåº¦çš„æœ€ä½è¦æ±‚ï¼ˆæ¯”å¦‚ 1x å®æ—¶ / 0.3x ä¹Ÿèƒ½æ¥å—ï¼‰**ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»™ä½ ä¸€ä¸ªæ›´æ˜ç¡®çš„â€œä¼˜å…ˆç”¨å“ªç±» + æ··åˆå·¥ä½œæµï¼ˆæ¯å¸¦ç”¨ Aï¼Œé‡äº§ç”¨ Bï¼‰â€çš„æ–¹æ¡ˆã€‚


# Fine-tune

ç®€çŸ­ç»“è®ºå…ˆç»™ä½ ä¸€å¥**å¯æ‰§è¡Œçš„åˆ¤æ–­**ï¼š

> **å¯¹ token-based TTSï¼ˆXTTS / CosyVoice è¿™ç±»ï¼‰ï¼ŒFine-tune å‡ ä¹ä¸€å®šä¼šæ¯” zero-shot æ˜æ˜¾å¥½ï¼Œä½†â€œæå‡ç‚¹â€ä¸»è¦é›†ä¸­åœ¨ã€ç¨³å®šæ€§ã€å¯æ§æ€§ã€ä¸€è‡´æ€§ã€‘ï¼Œè€Œä¸æ˜¯æ— é™æ¥è¿‘çœŸäººçš„æé™éŸ³è‰²ã€‚**

ä¸‹é¢æˆ‘åˆ†å±‚è¯´æ¸…æ¥š **ä¼šå¥½åœ¨å“ªé‡Œã€å¥½ä¸åˆ°å“ªé‡Œã€ä»€ä¹ˆæ—¶å€™å€¼å¾—åš**ã€‚

---

## ä¸€ã€Fine-tune åï¼Œtoken-based TTSã€Œç¡®å®šä¼šæ˜æ˜¾å˜å¥½ã€çš„åœ°æ–¹

### 1ï¸âƒ£ **éŸ³è‰²ç¨³å®šæ€§ï¼ˆæœ€æ˜¾è‘—æå‡ï¼‰**

**zero-shot å¸¸è§é—®é¢˜ï¼š**

- åŒä¸€ä¸ªäººï¼Œç« èŠ‚ä¹‹é—´éŸ³è‰²æ…¢æ…¢æ¼‚
    
- å¥é¦–/å¥å°¾éŸ³è‰²å˜åŒ–å¤§
    
- æƒ…ç»ªä¸€å˜ï¼Œå£°éŸ³å°±â€œä¸åƒæœ¬äººâ€
    

**Fine-tune åï¼š**

- æ¨¡å‹æŠŠä½ çš„å£°éŸ³**å½“æˆâ€œä¸€ä¸ªæ˜ç¡®çš„è¯´è¯äººåˆ†å¸ƒâ€**
    
- speaker embedding / style token ä¼šæ›´â€œæ”¶æ•›â€
    
- æœ‰å£°ä¹¦å‡ åä¸‡å­—ä¸‹æ¥ï¼Œ**å£°éŸ³ä¸€è‡´æ€§æ˜æ˜¾æå‡**
    

ğŸ‘‰ è¿™æ˜¯ token-based å¾®è°ƒ **æ€§ä»·æ¯”æœ€é«˜** çš„æ”¶ç›Šç‚¹ã€‚

---

### 2ï¸âƒ£ **å‘éŸ³ä¸å’¬å­—å‡†ç¡®ç‡ï¼ˆå°¤å…¶ä¸­æ–‡ï¼‰**

**zero-shotï¼š**

- å¤šéŸ³å­—ã€è½»å£°ã€å„¿åŒ–ã€è¯­æ°”è¯å®¹æ˜“è¢«â€œå¹³å‡åŒ–â€
    
- æŸäº›å­—æ°¸è¿œå¿µå¾—æ€ªï¼Œä½†ä¸æ˜¯å®Œå…¨é”™
    

**Fine-tuneï¼š**

- æ¨¡å‹å­¦ä¼šä½ å£°éŸ³é‡Œ**çœŸå®å­˜åœ¨çš„å‘éŸ³ä¹ æƒ¯**
    
- å¸¸è§å­—ã€å¸¸è§ç»“æ„ä¼šè¢«â€œè®°ä½â€
    
- é”™è¯¯ç‡æ˜æ˜¾ä¸‹é™ï¼ˆä¸æ˜¯ 100% æ¶ˆå¤±ï¼Œä½†å¾ˆæ˜æ˜¾ï¼‰
    

ğŸ‘‰ å¯¹ä¸­æ–‡æœ‰å£°ä¹¦éå¸¸å…³é”®ã€‚

---

### 3ï¸âƒ£ **é•¿æ–‡æœ¬é²æ£’æ€§**

**zero-shotï¼š**

- å¥å­è¶Šé•¿ï¼ŒèŠ‚å¥è¶Šå®¹æ˜“ä¹±
    
- æƒ…ç»ª/è¯­è°ƒåœ¨æ®µè½ä¸­é—´å´©æ‰
    

**Fine-tuneï¼š**

- æ¨¡å‹æ›´æ¸…æ¥šâ€œè¿™ä¸ªè¯´è¯äººå¦‚ä½•è¯»é•¿å¥â€
    
- åœé¡¿ã€è¯­è°ƒè½ç‚¹æ›´è‡ªç„¶
    
- ç« èŠ‚çº§åˆ«è¾“å‡ºæ›´ç¨³
    

ğŸ‘‰ è¿™æ˜¯ token-based åš audiobook çš„ä¸€ä¸ªâ€œåˆ†æ°´å²­â€ã€‚

---

### 4ï¸âƒ£ **ä½ è°ƒçš„â€œæ§åˆ¶å‚æ•°â€ä¼šæ›´å¬è¯**

æ¯”å¦‚ï¼š

- è¯­é€Ÿ
    
- æƒ…ç»ª token / style prompt
    
- åœé¡¿ / prosody ç›¸å…³æ§åˆ¶
    

**åŸå› ï¼š**  
Fine-tune åï¼Œæ¨¡å‹å­¦çš„æ˜¯**ä½ è¿™ä¸ªäºº + è¿™äº›æ§åˆ¶ä¿¡å·ä¹‹é—´çš„å¯¹åº”å…³ç³»**ï¼Œè€Œä¸æ˜¯æ³›åŒ–å¹³å‡å€¼ã€‚

---

## äºŒã€Fine-tune åï¼Œã€Œæå‡æœ‰é™ã€ç”šè‡³åŸºæœ¬ä¸ä¼šè§£å†³çš„é—®é¢˜

### âŒ 1ï¸âƒ£ çœŸäººæ„Ÿä¸Šé™ï¼ˆbreathã€å¾®è¡¨æƒ…ï¼‰

å³ä½¿ fine-tuneï¼š

- æ°”å£°ç»†èŠ‚
    
- å‘¼å¸ã€å£æ°´éŸ³
    
- è¶…ç»†å¾®æƒ…ç»ªå˜åŒ–
    

**token-based ä»ç„¶å—é™äºï¼š**

- ç¦»æ•£ codec token
    
- è®­ç»ƒæ—¶çš„é‡æ„ä¸Šé™
    

ğŸ‘‰ æ‰€ä»¥å®ƒ**å¾ˆéš¾è¾¾åˆ°é¡¶çº§ token-freeï¼ˆè¿ç»­å»ºæ¨¡ï¼‰é‚£ç§â€œåƒå½•éŸ³â€çš„è´¨æ„Ÿ**ã€‚

---

### âŒ 2ï¸âƒ£ æçŸ­æ ·æœ¬å…‹éš†ï¼ˆ10â€“20 ç§’ï¼‰

- Fine-tune ä¸æ˜¯é­”æ³•
    
- æ•°æ®å¤ªå°‘æ—¶ï¼Œå¾ˆå®¹æ˜“è¿‡æ‹Ÿåˆæˆ–å­¦æ­ª
    

ğŸ‘‰ token-based å¾®è°ƒ**æ›´é€‚åˆ 5â€“30 åˆ†é’Ÿä»¥ä¸Šçš„å¹²å‡€è¯­éŸ³**ã€‚

---

## ä¸‰ã€Fine-tune å¯¹ token-based çš„ã€ŒçœŸå®æå‡æ›²çº¿ã€

|æ•°æ®é‡|æå‡æ•ˆæœ|
|---|---|
|30â€“60 ç§’|âŒ ä¸å»ºè®®ï¼ˆå‡ ä¹æ²¡æ„ä¹‰ï¼‰|
|5â€“10 åˆ†é’Ÿ|âœ” ç¨³å®šæ€§ç•¥å¥½|
|20â€“40 åˆ†é’Ÿ|â­â­ æ˜æ˜¾å¥½äº zero-shot|
|1â€“3 å°æ—¶|â­â­â­ audiobook å¯ç”¨çº§åˆ«|
|5â€“10 å°æ—¶|â­â­â­â­ å•†ç”¨ç¨³å®šçº§|

---

## å››ã€å’Œ token-free Fine-tune çš„æœ¬è´¨å·®å¼‚

ä¸€å¥è¯æ¦‚æ‹¬ï¼š

> **token-based å¾®è°ƒ = è®©æ¨¡å‹â€œæ›´åƒä½ ã€æ›´ç¨³å®šã€æ›´å¥½ç”¨â€  
> token-free å¾®è°ƒ = æŠŠä½ çš„å£°éŸ³â€œé‡å»ºå¾—æ›´åƒå½•éŸ³â€**

æ‰€ä»¥ï¼š

- **è¿½æ±‚ç”Ÿäº§åŠ› / é•¿ä¹¦ / ç¨³å®š** â†’ token-based FT éå¸¸å€¼å¾—
    
- **è¿½æ±‚æé™éŸ³è´¨ / å£°çº¹ç›¸ä¼¼åº¦** â†’ token-free æ›´æœ‰ä¸Šé™
    

---

## äº”ã€ç»™ä½ ä¸€ä¸ªâ€œèªæ˜çš„æ··åˆç­–ç•¥â€ï¼ˆéå¸¸å®ç”¨ï¼‰

å¾ˆå¤šä¸“ä¸šæµç¨‹å…¶å®æ˜¯ï¼š

1ï¸âƒ£ **token-based FT**  
â†’ ç”¨äºï¼š

- æ‰¹é‡ç”Ÿæˆ
    
- æœ‰å£°ä¹¦ä¸»ä½“
    
- CPU / MPS / CUDA éƒ½èƒ½è·‘
    

2ï¸âƒ£ **token-freeï¼ˆzero-shot æˆ–è½» FTï¼‰**  
â†’ ç”¨äºï¼š

- é‡è¦ç‰‡æ®µ
    
- æƒ…ç»ªé«˜æ½®
    
- è¯•å¬æ ·ç« 
    

---

## å…­ã€ç›´æ¥å›ç­”ä½ çš„é—®é¢˜ï¼ˆæ€»ç»“ç‰ˆï¼‰

> **æ˜¯çš„ï¼Œtoken-based TTS å¦‚æœèƒ½ fine-tuneï¼Œæ•ˆæœä¸€å®šä¼šæ›´å¥½ã€‚**

**ä¸»è¦å¥½åœ¨ï¼š**

- éŸ³è‰²ä¸€è‡´æ€§ âœ”âœ”âœ”
    
- å‘éŸ³å‡†ç¡®ç‡ âœ”âœ”
    
- é•¿æ–‡æœ¬ç¨³å®šæ€§ âœ”âœ”âœ”
    
- æ§åˆ¶èƒ½åŠ› âœ”âœ”
    

**ä½†ä¸ä¼šå®Œå…¨è§£å†³ï¼š**

- çœŸäººæ„Ÿä¸Šé™
    
- å¾®ç»†å‘¼å¸/æ°”å£°
    

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥å¸®ä½ åšä¸‰ä»¶äº‹ä¹‹ä¸€ï¼š  
1ï¸âƒ£ **XTTS vs CosyVoiceï¼šå“ªä¸ªæ›´å€¼å¾— fine-tuneï¼ˆä»å·¥ç¨‹å’ŒéŸ³è´¨ï¼‰**  
2ï¸âƒ£ **æœ€å°æˆæœ¬çš„ token-based å¾®è°ƒæ•°æ®å‡†å¤‡æ¸…å•ï¼ˆå«ä¸­æ–‡ç»†èŠ‚ï¼‰**  
3ï¸âƒ£ **ä¸€ä¸ªâ€œæœ‰å£°ä¹¦çº§â€çš„æ¨èè®­ç»ƒå‚æ•°æ¨¡æ¿**

# FT2

å¾ˆå¥½ï¼Œè¿™é‡Œæˆ‘**ä¸€æ¬¡æ€§æŠŠä¸‰ä»¶äº‹éƒ½ç»™ä½ â€œå·¥ç¨‹çº§ã€å¯è½åœ°â€åœ°åˆ—æ¸…æ¥š**ã€‚å†…å®¹ä¼šæ¯”è¾ƒå¯†ï¼Œä½†è¿™æ˜¯ä½ è¦åš**é•¿æœŸæœ‰å£°ä¹¦ + ç¦»çº¿ TTS + å£°éŸ³å…‹éš†**æ—¶ï¼ŒçœŸæ­£è¯¥çŸ¥é“çš„ç‰ˆæœ¬ã€‚

---

# ä¸€ã€XTTS vs CosyVoiceï¼šå“ªä¸ªæ›´å€¼å¾— Fine-Tuneï¼Ÿ

> ç»“è®ºå…ˆè¡Œï¼ˆç»“åˆä½ å‰é¢å¯¹éŸ³è´¨ä¸å…‹éš†çš„é‡è§†ï¼‰ï¼š

**ğŸ‘‰ æœ‰å£°ä¹¦ + ç¨³å®šé‡äº§ä¼˜å…ˆï¼šCosyVoice FT  
ğŸ‘‰ è·¨è¯­è¨€ / å¿«é€Ÿä¸Šæ‰‹ / ç¤¾åŒºæˆç†Ÿåº¦ï¼šXTTS FT**

ä¸‹é¢æ˜¯**å®æˆ˜ç»´åº¦å¯¹æ¯”**ã€‚

---

## 1ï¸âƒ£ æ¶æ„ & è®­ç»ƒå–å‘å·®å¼‚

| ç»´åº¦         | XTTS                       | CosyVoice / CosyVoice FT            |
| ---------- | -------------------------- | ----------------------------------- |
| æ¶æ„         | GPT-style token LM + codec | æ›´å TTS å·¥ç¨‹åŒ–ï¼ˆå£°å­¦çº¦æŸæ›´å¼ºï¼‰                  |
| è®­ç»ƒç›®æ ‡       | å¼º zero-shot / multilingual | å¼ºå•è¯´è¯äºº / é•¿æ–‡æœ¬                         |
| speaker è¡¨ç¤º | speaker embedding + prompt | speaker embedding + prosody / style |
| ä¸­æ–‡é€‚é…       | å¯ç”¨ä½†åâ€œæ³›åŒ–â€                   | **æ˜æ˜¾æ›´å¥½**                            |
| æœ‰å£°ä¹¦ç¨³å®šæ€§     | ä¸­                          | **é«˜**                               |

ğŸ‘‰ **CosyVoice æ›´åƒâ€œä¸º audiobook è®¾è®¡çš„ token-based TTSâ€**ã€‚

---

## 2ï¸âƒ£ Fine-Tune åçš„çœŸå®å·®è·

### ğŸ§ éŸ³è‰²ä¸€è‡´æ€§

- **CosyVoice FT > XTTS FT**
    
- CosyVoice åœ¨ç« èŠ‚çº§åˆ«æ›´ä¸å®¹æ˜“â€œæ¼‚éŸ³è‰²â€
    

### ğŸ—£ ä¸­æ–‡å‘éŸ³ & è¯­è°ƒ

- CosyVoice å¯¹ï¼š
    
    - è½»å£°
        
    - è¯­æ°”è¯
        
    - é•¿å¥åœé¡¿  
        æ›´è‡ªç„¶
        

### âš™ï¸ å·¥ç¨‹å¯æ§æ€§

- CosyVoice æ›´å®¹æ˜“åŠ ï¼š
    
    - æ–­å¥ç­–ç•¥
        
    - ç« èŠ‚ reset speaker
        
    - prosody ç¨³å®šå™¨
        

---

## 3ï¸âƒ£ æˆ‘çš„ç›´æ¥å»ºè®®

- **ä½ å·²ç»åœ¨ç”¨ IndexTTS / CosyVoice ä½“ç³»**
    
- **ç›®æ ‡æ˜¯â€œé•¿æœŸæœ‰å£°ä¹¦â€**
    

ğŸ‘‰ **ä¼˜å…ˆ CosyVoice FT**  
ğŸ‘‰ XTTS å¯ä»¥ä¿ç•™ä¸ºï¼š

- è‹±æ–‡
    
- è·¨è¯­è¨€
    
- å®éªŒç”¨
    

---

# äºŒã€Token-based å¾®è°ƒï¼šæœ€å°æˆæœ¬ã€æœ€å¤§æ”¶ç›Šçš„æ•°æ®å‡†å¤‡æ¸…å•

è¿™æ˜¯å¾ˆå¤šäººåšåçš„åœ°æ–¹ï¼Œæˆ‘ç›´æ¥ç»™ä½ **ä¸ä¼šç¿»è½¦çš„æ ‡å‡†**ã€‚

---

## 1ï¸âƒ£ æ•°æ®é‡ & è´¨é‡ï¼ˆåº•çº¿ï¼‰

### âœ… æ¨èåŒºé—´

- **æœ€ä½å¯ç”¨**ï¼š20â€“30 åˆ†é’Ÿ
    
- **ç†æƒ³**ï¼š1â€“3 å°æ—¶
    
- **éå¸¸å¥½**ï¼š5â€“10 å°æ—¶
    

### âŒ ä¸è¦ç”¨

- æœ‰æ··å“
    
- æœ‰èƒŒæ™¯éŸ³ä¹
    
- è¿‡åº¦å‹ç¼©ï¼ˆæŠ–éŸ³ã€Bç«™ä¸‹è½½éŸ³ï¼‰
    

---

## 2ï¸âƒ£ éŸ³é¢‘è§„æ ¼ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

```text
é‡‡æ ·ç‡ï¼š24k æˆ– 22.05kï¼ˆä¸è¦æ··ï¼‰
å£°é“ï¼šMono
ä½æ·±ï¼š16bit æˆ– 24bit
æ ¼å¼ï¼šWAV
```

**ä¸€å¥è¯ï¼šå®å¯é«˜è§„æ ¼å†é™é‡‡æ ·ï¼Œä¸è¦ä¸€å¼€å§‹å°±ä½è´¨ã€‚**

---

## 3ï¸âƒ£ æ–‡æœ¬è§„èŒƒï¼ˆä¸­æ–‡æå…¶é‡è¦ï¼‰

### âœ… å¿…åš

- é˜¿æ‹‰ä¼¯æ•°å­— â†’ ä¸­æ–‡æ•°å­—  
    `2025 â†’ äºŒé›¶äºŒäº”`
    
- è‹±æ–‡é¦–å­—æ¯ â†’ è¯»æ³•ç»Ÿä¸€  
    `AI â†’ A I`
    
- å»æ‰èŠ±å“¨æ ‡ç‚¹
    
- ä¿ç•™ï¼š
    
    - é€—å·
        
    - å¥å·
        
    - é—®å·
        

### âŒ ä¸è¦

- Emoji
    
- è¡¨æƒ…ç¬¦å·
    
- ç½‘ç»œç¼©å†™
    

---

## 4ï¸âƒ£ å¼ºçƒˆæ¨èçš„åˆ‡åˆ†ç­–ç•¥

```text
æ¯æ¡éŸ³é¢‘ï¼š5â€“12 ç§’
ä¸€å¥æˆ–åŠå¥ä¸ºä½³
```

åŸå› ï¼š

- token-based åœ¨è¿™ä¸ªé•¿åº¦å­¦ä¹  speaker æœ€ç¨³å®š
    
- é•¿å¥è®© prosody å­¦æ­ª
    
- çŸ­å¥è®©èŠ‚å¥ç¢
    

---

## 5ï¸âƒ£ æ•°æ®ç›®å½•æ¨¡æ¿ï¼ˆå®æˆ˜ç”¨ï¼‰

```text
data/
 â”œâ”€ wavs/
 â”‚   â”œâ”€ 000001.wav
 â”‚   â”œâ”€ 000002.wav
 â”‚   â””â”€ ...
 â”œâ”€ metadata.csv
```

`metadata.csv`

```csv
000001.wav|è¿™æ˜¯ç¬¬ä¸€å¥æ—ç™½ã€‚
000002.wav|ä»–è½»å£°è¯´é“ï¼Œç„¶ååœé¡¿äº†ä¸€ä¸‹ã€‚
```

---

# ä¸‰ã€æœ‰å£°ä¹¦çº§ Token-based Fine-Tune å‚æ•°æ¨¡æ¿ï¼ˆç¨³å®šä¼˜å…ˆï¼‰

> ä»¥ä¸‹æ˜¯â€œ**ä¸ä¼šç‚¸ã€å¯é•¿è·‘**â€é…ç½®å–å‘ã€‚

---

## 1ï¸âƒ£ è®­ç»ƒç­–ç•¥

- **å†»ç»“ codec / vocoder**
    
- **åªè®­ç»ƒï¼š**
    
    - speaker embedding
        
    - text â†’ acoustic token æ˜ å°„
        
- ä¸è¿½æ±‚ loss æä½ï¼Œè¿½æ±‚**æ³›åŒ–ç¨³å®š**
    

---

## 2ï¸âƒ£ Batch & å­¦ä¹ ç‡ï¼ˆç»éªŒå€¼ï¼‰

|å‚æ•°|æ¨è|
|---|---|
|batch size|å°½é‡å¤§ï¼ˆæ˜¾å­˜å…è®¸ï¼‰|
|lr|`1e-4 â†’ 5e-5`|
|warmup|5â€“10%|
|epochs|5â€“15|

ğŸ‘‰ çœ‹åˆ°éŸ³è‰²ç¨³å®šå°±åœï¼Œä¸è¦è´ªã€‚

---

## 3ï¸âƒ£ è®­ç»ƒç›‘æ§ä½ è¦å¬ä»€ä¹ˆ

- âŒ ä¸è¦åªçœ‹ loss
    
- âœ… æ¯éš” N stepï¼š
    
    - åŒä¸€å¥æµ‹è¯•æ–‡æœ¬
        
    - ä¸åŒé•¿åº¦æ–‡æœ¬
        
    - æƒ…ç»ªå˜åŒ–æ–‡æœ¬
        

**åˆ¤æ–­æ ‡å‡†ï¼š**

- åŒä¸€å¥è¯ï¼Œæ¯æ¬¡ç”Ÿæˆéƒ½â€œåƒåŒä¸€ä¸ªäººâ€
    
- ç« èŠ‚çº§åˆ«ä¸æ¼‚
    

---

## 4ï¸âƒ£ æ¨ç†é˜¶æ®µçš„ audiobook æŠ€å·§

- **æ¯ç«  reset speaker embedding**
    
- æ®µè½çº§ç”Ÿæˆï¼ˆä¸è¦æ•´ç« ä¸€æ¡ï¼‰
    
- å›ºå®šéšæœºç§å­ï¼ˆé˜²æ¼‚ï¼‰
    

---

# å››ã€ä½ ç°åœ¨è¯¥æ€ä¹ˆé€‰ï¼ˆæœ€ç»ˆå†³ç­–ç‰ˆï¼‰

|ç›®æ ‡|æ–¹æ¡ˆ|
|---|---|
|ä¸»åŠ›æœ‰å£°ä¹¦|**CosyVoice FT**|
|æè‡´éŸ³è´¨ç‰‡æ®µ|IndexTTS|
|è‹±æ–‡ / å¤šè¯­|XTTS|
|CPU / MPS|token-based|
|å•†ç”¨ç¨³å®š|token-based FT|

---

## å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ ï¼š

1ï¸âƒ£ ç»™ä½  **CosyVoice FT çš„å®Œæ•´è®­ç»ƒå‘½ä»¤ + config æ¨¡æ¿**  
2ï¸âƒ£ å†™ä¸€ä¸ª **ä¸­æ–‡ audiobook æ•°æ®æ¸…æ´—è„šæœ¬ï¼ˆæ•°å­—/æ ‡ç‚¹/åˆ‡åˆ†ï¼‰**  
3ï¸âƒ£ è®¾è®¡ä¸€ä¸ª **token-based + token-free æ··åˆç”Ÿæˆæµæ°´çº¿**

ä½ åªè¦å‘Šè¯‰æˆ‘ï¼š**ä½ ç°åœ¨ä¸»è¦ç”¨ CUDA / MPS / CPUï¼Ÿ**  
æˆ‘å¯ä»¥ç›´æ¥æŒ‰ä½ çš„ç¡¬ä»¶ç»™ä½ å¯è·‘çš„ç‰ˆæœ¬ã€‚

# synthesis

ä¸‹é¢åˆ†ä¸‰å—ç»™ä½ ï¼š

1. **ä¸­æ–‡ audiobook æ•°æ®æ¸…æ´—è„šæœ¬**ï¼ˆæ•°å­—è§„èŒƒåŒ– / æ ‡ç‚¹è§„èŒƒåŒ– / æŒ‰å¥åˆ‡åˆ†+åˆå¹¶æˆ 5â€“12 ç§’å¸¸ç”¨çš„â€œæ–‡æœ¬å—â€ï¼‰
    
2. **â€œæ¯ç«  reset speaker embeddingâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¸ºä»€ä¹ˆèƒ½é˜²æ¼‚ï¼Œæ€ä¹ˆåš**
    
3. **â€œå›ºå®šéšæœºç§å­ï¼ˆé˜²æ¼‚ï¼‰â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ€ä¹ˆåšï¼ˆå«ä»£ç æ¨¡æ¿ï¼‰**
    

---

## 1) ä¸­æ–‡ audiobook æ•°æ®æ¸…æ´—è„šæœ¬ï¼ˆæ•°å­—/æ ‡ç‚¹/åˆ‡åˆ†ï¼‰

è¿™ä¸ªè„šæœ¬åšä¸‰ä»¶äº‹ï¼š

- **æ•°å­—è§„èŒƒåŒ–**
    
    - `2025` â†’ `äºŒé›¶äºŒäº”`ï¼ˆå¹´ä»½é»˜è®¤æŒ‰â€œé€ä½è¯»â€ï¼‰
        
    - `12` â†’ `åäºŒ`
        
    - `3.14` â†’ `ä¸‰ç‚¹ä¸€å››`
        
    - `50%` â†’ `ç™¾åˆ†ä¹‹äº”å`
        
- **æ ‡ç‚¹è§„èŒƒåŒ–**
    
    - è‹±æ–‡æ ‡ç‚¹è½¬ä¸­æ–‡æ ‡ç‚¹ï¼š`,`â†’`ï¼Œ` `.`â†’`ã€‚` `?`â†’`ï¼Ÿ` `!`â†’`ï¼`
        
    - è¿ç»­é‡å¤æ ‡ç‚¹å‹ç¼©
        
    - å¤šä½™ç©ºæ ¼æ¸…ç†
        
- **åˆ‡åˆ†**
    
    - å…ˆæŒ‰å¥å·é—®å·æ„Ÿå¹å·ç­‰åˆ‡å¥
        
    - å†æŠŠçŸ­å¥**åˆå¹¶**æˆç›®æ ‡é•¿åº¦ï¼ˆé»˜è®¤ 35â€“90 ä¸ªæ±‰å­—/å­—ç¬¦ä¸€ä¸ªå—ï¼Œé€‚åˆ 5â€“12 ç§’é…éŸ³è®­ç»ƒï¼‰
        

> è¾“å‡ºï¼š`metadata.csv`ï¼ˆ`id|clean_text`ï¼‰ï¼Œä»¥åŠå¯é€‰çš„æ¯ç« åˆ†å—æ–‡æœ¬æ–‡ä»¶ã€‚

### âœ… è„šæœ¬ï¼š`zh_audiobook_clean.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Chinese audiobook text cleaner:
- normalize punctuation (EN -> ZH), remove weird symbols, collapse repeats
- normalize numbers:
    - years (e.g. 2025 -> äºŒé›¶äºŒäº”) default: digit-by-digit
    - integers (12 -> åäºŒ), decimals (3.14 -> ä¸‰ç‚¹ä¸€å››), percent (50% -> ç™¾åˆ†ä¹‹äº”å)
- sentence split and merge into chunks for TTS training / inference
Output:
- metadata.csv lines: <utt_id>|<clean_text>

Usage examples:
  python zh_audiobook_clean.py --in_txt chapter1.txt --out metadata.csv --prefix ch01
  python zh_audiobook_clean.py --in_dir chapters/ --out metadata.csv
"""

from __future__ import annotations
import argparse
import os
import re
from pathlib import Path
from typing import List, Iterable, Tuple

DIGITS_ZH = "é›¶ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹"
UNITS = ["", "å", "ç™¾", "åƒ"]
BIG_UNITS = ["", "ä¸‡", "äº¿", "å…†"]

# ----------------------------
# Number conversion helpers
# ----------------------------

def digits_reading(num_str: str) -> str:
    """Read number digit-by-digit: '2025' -> 'äºŒé›¶äºŒäº”'."""
    return "".join(DIGITS_ZH[ord(ch) - 48] for ch in num_str if ch.isdigit())

def int_to_zh(n: int) -> str:
    """Convert integer 0.. to Chinese numerals (common reading)."""
    if n == 0:
        return "é›¶"
    if n < 0:
        return "è´Ÿ" + int_to_zh(-n)

    def four_to_zh(x: int) -> str:
        assert 0 <= x <= 9999
        s = ""
        zero = False
        for i in range(3, -1, -1):
            d = x // (10 ** i) % 10
            if d == 0:
                zero = True if s else False
            else:
                if zero:
                    s += "é›¶"
                    zero = False
                s += DIGITS_ZH[d] + UNITS[i]
        return s

    parts = []
    unit_idx = 0
    while n > 0:
        chunk = n % 10000
        if chunk != 0:
            chunk_zh = four_to_zh(chunk) + BIG_UNITS[unit_idx]
            parts.append(chunk_zh)
        else:
            parts.append("")  # placeholder
        n //= 10000
        unit_idx += 1

    # combine from high to low with zero handling between chunks
    res = ""
    for i in range(len(parts) - 1, -1, -1):
        p = parts[i]
        if not p:
            # if there are non-empty later and earlier parts, add a zero bridge
            if res and any(parts[j] for j in range(i)):
                if not res.endswith("é›¶"):
                    res += "é›¶"
            continue
        # bridge zero if needed: e.g., 10001 => ä¸€ä¸‡é›¶ä¸€
        if res and not res.endswith("é›¶"):
            # if the current chunk is less than 1000 and there is a higher chunk, need "é›¶"
            # Example: 1ä¸‡ + 1 => ä¸€ä¸‡é›¶ä¸€
            # Detect by raw numeric width: if p doesn't start with åƒ/ç™¾/å but earlier chunk exists.
            pass
        res += p

    # fix common "ä¸€åX" -> "åX"
    res = re.sub(r"^ä¸€å", "å", res)
    # remove trailing zero
    res = re.sub(r"é›¶+$", "", res)
    # collapse duplicates
    res = re.sub(r"é›¶{2,}", "é›¶", res)
    return res

def decimal_to_zh(s: str) -> str:
    """Convert decimal like '3.14' -> 'ä¸‰ç‚¹ä¸€å››'."""
    if "." not in s:
        return int_to_zh(int(s))
    a, b = s.split(".", 1)
    a_zh = int_to_zh(int(a)) if a and a.lstrip("-").isdigit() else digits_reading(a)
    b_zh = digits_reading(b)
    return f"{a_zh}ç‚¹{b_zh}"

def normalize_numbers(text: str) -> str:
    """
    Normalize:
    - percent: 50% => ç™¾åˆ†ä¹‹äº”å
    - years: 1998å¹´ => ä¸€ä¹ä¹å…«å¹´ (digit-by-digit)
    - decimals: 3.14 => ä¸‰ç‚¹ä¸€å››
    - integers: 12 => åäºŒ
    """

    # Percent: 50% / 12.5%
    def repl_percent(m: re.Match) -> str:
        num = m.group(1)
        if "." in num:
            zh = decimal_to_zh(num)
            # "ä¸‰ç‚¹ä¸€å››" already; percent normally prefers number, ok
        else:
            zh = int_to_zh(int(num))
        return f"ç™¾åˆ†ä¹‹{zh}"

    text = re.sub(r"\b(\d+(?:\.\d+)?)\s*%\b", repl_percent, text)

    # Years: 4-digit + å¹´ / ä¸–çºªç­‰ï¼ˆé»˜è®¤é€ä½è¯»ï¼‰
    def repl_year(m: re.Match) -> str:
        y = m.group(1)
        return digits_reading(y) + "å¹´"

    text = re.sub(r"\b(\d{4})\s*å¹´", repl_year, text)

    # Decimals: 3.14
    def repl_decimal(m: re.Match) -> str:
        return decimal_to_zh(m.group(0))

    text = re.sub(r"\b-?\d+\.\d+\b", repl_decimal, text)

    # Integers: 0.. (avoid touching things like IDs inside words)
    def repl_int(m: re.Match) -> str:
        s = m.group(0)
        # keep very long numbers as digit-by-digit to avoid weirdness
        digits = s.lstrip("-")
        if len(digits) >= 7:
            return ("è´Ÿ" if s.startswith("-") else "") + digits_reading(digits)
        return int_to_zh(int(s))

    text = re.sub(r"\b-?\d+\b", repl_int, text)

    return text

# ----------------------------
# Punctuation + cleanup
# ----------------------------

_PUNCT_MAP = str.maketrans({
    ",": "ï¼Œ",
    ".": "ã€‚",
    "?": "ï¼Ÿ",
    "!": "ï¼",
    ":": "ï¼š",
    ";": "ï¼›",
    "(": "ï¼ˆ",
    ")": "ï¼‰",
    "[": "ã€",
    "]": "ã€‘",
    "<": "ã€Š",
    ">": "ã€‹",
    "~": "ï½",
})

def normalize_punct(text: str) -> str:
    text = text.translate(_PUNCT_MAP)

    # unify quotes: keep Chinese quotes, remove messy double quotes
    text = text.replace('"', "â€œ")  # crude but helps consistency
    # collapse repeated punctuation
    text = re.sub(r"[ï¼Œ,]{2,}", "ï¼Œ", text)
    text = re.sub(r"[ã€‚\.]{2,}", "ã€‚", text)
    text = re.sub(r"[ï¼!]{2,}", "ï¼", text)
    text = re.sub(r"[ï¼Ÿï¼Ÿ\?]{2,}", "ï¼Ÿ", text)
    text = re.sub(r"[ï¼›;]{2,}", "ï¼›", text)

    # remove weird symbols often found in scraped novels
    text = re.sub(r"[â˜…â˜†â—†â—‡â– â–¡â—â—â€¢Â·]", "", text)

    # normalize ellipsis
    text = text.replace("......", "â€¦â€¦")
    text = re.sub(r"â€¦{3,}", "â€¦â€¦", text)

    # normalize spaces
    text = re.sub(r"[ \t]+", " ", text)
    # strip spaces around Chinese punctuation
    text = re.sub(r"\s*([ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼š])\s*", r"\1", text)
    # remove leading/trailing spaces
    return text.strip()

# ----------------------------
# Sentence split + merge
# ----------------------------

SENT_SPLIT_RE = re.compile(r"(?<=[ã€‚ï¼ï¼Ÿï¼›])")  # split after these

def split_sentences(text: str) -> List[str]:
    # ensure sentence-ending punctuation where missing at line end
    text = re.sub(r"\n+", "\n", text)
    # replace newlines with sentence breaks
    text = text.replace("\n", "ã€‚")
    parts = [p.strip() for p in SENT_SPLIT_RE.split(text) if p.strip()]
    # filter out too short noise
    parts = [p for p in parts if re.search(r"[\u4e00-\u9fffA-Za-z0-9]", p)]
    return parts

def merge_to_chunks(
    sentences: List[str],
    min_len: int = 35,
    max_len: int = 90,
) -> List[str]:
    """
    Merge short sentences into chunks with target char length range.
    """
    chunks = []
    buf = ""

    def flush():
        nonlocal buf
        if buf:
            chunks.append(buf)
            buf = ""

    for s in sentences:
        if not buf:
            buf = s
        else:
            # try to append with natural comma if needed
            candidate = buf + ("" if buf.endswith(("ï¼Œ","ã€‚","ï¼","ï¼Ÿ","ï¼›","ï¼š")) else "ï¼Œ") + s
            if len(candidate) <= max_len:
                buf = candidate
            else:
                # if current buffer is too short, allow slightly exceeding max
                if len(buf) < min_len:
                    buf = candidate
                else:
                    flush()
                    buf = s

    flush()

    # final pass: split any extremely long chunk by commas
    final = []
    for c in chunks:
        if len(c) <= max_len + 20:
            final.append(c)
            continue
        # split by comma-like punctuation
        sub = re.split(r"(ï¼Œ|ï¼›|ï¼š)", c)
        tmp = ""
        for part in sub:
            if not part:
                continue
            cand = tmp + part
            if len(cand) <= max_len:
                tmp = cand
            else:
                if tmp:
                    final.append(tmp)
                tmp = part.lstrip("ï¼Œï¼›ï¼š")
        if tmp:
            final.append(tmp)

    # cleanup: ensure ending punctuation
    cleaned = []
    for c in final:
        c = c.strip("ï¼Œ")
        if c and c[-1] not in "ã€‚ï¼ï¼Ÿï¼›":
            c += "ã€‚"
        cleaned.append(c)
    return cleaned

def clean_text(raw: str) -> str:
    t = raw
    t = normalize_punct(t)
    t = normalize_numbers(t)
    t = normalize_punct(t)  # run again after number expansion
    return t

# ----------------------------
# IO
# ----------------------------

def iter_input_files(in_txt: str | None, in_dir: str | None) -> List[Path]:
    if in_txt:
        return [Path(in_txt)]
    if in_dir:
        d = Path(in_dir)
        files = sorted([p for p in d.glob("*.txt") if p.is_file()])
        return files
    raise ValueError("Provide --in_txt or --in_dir")

def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--in_txt", type=str, default=None, help="Single chapter text file")
    ap.add_argument("--in_dir", type=str, default=None, help="Directory containing *.txt chapters")
    ap.add_argument("--out", type=str, required=True, help="Output metadata.csv path")
    ap.add_argument("--prefix", type=str, default=None, help="Utt id prefix (default uses file stem)")
    ap.add_argument("--min_len", type=int, default=35)
    ap.add_argument("--max_len", type=int, default=90)
    ap.add_argument("--dump_chunks_dir", type=str, default=None, help="Optional: write per-chapter chunks to dir")
    args = ap.parse_args()

    files = iter_input_files(args.in_txt, args.in_dir)
    out_path = Path(args.out)
    out_path.parent.mkdir(parents=True, exist_ok=True)

    dump_dir = Path(args.dump_chunks_dir) if args.dump_chunks_dir else None
    if dump_dir:
        dump_dir.mkdir(parents=True, exist_ok=True)

    all_rows: List[Tuple[str, str]] = []
    global_idx = 1

    for f in files:
        raw = f.read_text(encoding="utf-8", errors="ignore")
        cleaned = clean_text(raw)
        sents = split_sentences(cleaned)
        chunks = merge_to_chunks(sents, min_len=args.min_len, max_len=args.max_len)

        base = args.prefix or f.stem
        chapter_rows = []
        for i, c in enumerate(chunks, start=1):
            utt_id = f"{base}_{i:04d}"
            chapter_rows.append((utt_id, c))
            all_rows.append((utt_id, c))
            global_idx += 1

        if dump_dir:
            (dump_dir / f"{base}.chunks.txt").write_text(
                "\n".join([f"{uid}\t{txt}" for uid, txt in chapter_rows]),
                encoding="utf-8"
            )

    # write metadata
    with out_path.open("w", encoding="utf-8") as w:
        for uid, txt in all_rows:
            w.write(f"{uid}|{txt}\n")

    print(f"Wrote {len(all_rows)} lines to: {out_path}")
    if dump_dir:
        print(f"Chunk dumps in: {dump_dir}")

if __name__ == "__main__":
    main()
```

### æ€ä¹ˆç”¨

```bash
# å•ç« 
python zh_audiobook_clean.py --in_txt ch01.txt --out metadata.csv --prefix ch01 --dump_chunks_dir chunks/

# å¤šç« ï¼ˆchapters/*.txtï¼‰
python zh_audiobook_clean.py --in_dir chapters/ --out metadata.csv --dump_chunks_dir chunks/
```

> è¿™ä¸ªè„šæœ¬åªç®¡â€œæ–‡æœ¬æ¸…æ´— + åˆ†å—â€ã€‚éŸ³é¢‘åˆ‡åˆ†ï¼ˆæŒ‰ 5â€“12 ç§’ wavï¼‰é€šå¸¸è¦ç»“åˆä½ å·²æœ‰çš„å½•éŸ³åˆ†æ®µæˆ–å¼ºåˆ¶å¯¹é½å·¥å…·ï¼›å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ ç°åœ¨çš„éŸ³é¢‘å½¢æ€ï¼ˆæ¯ç« ä¸€æ•´æ®µï¼Ÿè¿˜æ˜¯æœ¬æ¥å°±å¾ˆå¤šå° wavï¼Ÿï¼‰ï¼Œæˆ‘å¯ä»¥å†ç»™ä½ ä¸€ä¸ªâ€œæŒ‰æ—¶é—´æˆ³åˆ‡ wav + å¯¹é½ metadataâ€çš„ç‰ˆæœ¬ã€‚

---

## 2) â€œæ¯ç«  reset speaker embeddingâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚ä½•åšåˆ°ï¼Ÿ

### å®ƒæ˜¯ä»€ä¹ˆæ„æ€

åœ¨å¾ˆå¤š token-based TTS é‡Œï¼Œä½ ä¼šæœ‰ä¸€ä¸ªâ€œè¯´è¯äººæ¡ä»¶â€ï¼ˆspeaker conditioningï¼‰ï¼Œå¸¸è§å½¢å¼æ˜¯ï¼š

- **speaker embedding**ï¼šä»ä¸€æ®µå‚è€ƒéŸ³é¢‘æå–å‡ºæ¥çš„ä¸€ä¸ªå‘é‡ï¼ˆä»£è¡¨â€œè¿™ä¸ªäººçš„å£°çº¹/éŸ³è‰²â€ï¼‰
    
- **style/prosody embedding**ï¼šä»£è¡¨æƒ…ç»ªã€è¯­é€Ÿã€é£æ ¼çš„æ¡ä»¶
    

**â€œæ¯ç«  reset speaker embeddingâ€**å°±æ˜¯ï¼š

> æ¯ç”Ÿæˆä¸€ç« ï¼ˆæˆ–ä¸€ä¸ªè¾ƒå¤§æ®µè½ï¼‰ä¹‹å‰ï¼Œéƒ½**é‡æ–°ä»å‚è€ƒéŸ³é¢‘æå–ä¸€æ¬¡ speaker embedding**ï¼Œå¹¶ä¸”**ä¸è¦æ²¿ç”¨ä¸Šä¸€ç« ç”Ÿæˆè¿‡ç¨‹ä¸­çš„ä»»ä½•ç¼“å­˜/éšçŠ¶æ€**ï¼ˆæ¯”å¦‚ LM çš„ KV cacheã€ä¸Šä¸€æ®µçš„ style stateï¼‰ã€‚

### ä¸ºä»€ä¹ˆèƒ½é˜²â€œæ¼‚éŸ³è‰²â€

é•¿æ–‡æœ¬ç”Ÿæˆæ—¶ï¼Œæ¨¡å‹å†…éƒ¨å¯èƒ½å‡ºç°â€œæ¡ä»¶æ³„æ¼/ç´¯ç§¯åç§»â€ï¼š

- ä½ ä¸Šä¸€æ®µçš„ prosody / hidden state å½±å“ä¸‹ä¸€æ®µ
    
- é‡‡æ ·éšæœºæ€§è®©éŸ³è‰²ä¸€ç‚¹ç‚¹åç¦»
    
- KV cache æˆ–è¿ç»­ç”Ÿæˆé“¾æ¡è®©é£æ ¼æ…¢æ…¢æ¼‚
    

**reset**ç­‰äºæ¯ç« éƒ½â€œå›åˆ°åŒä¸€ä¸ªé”šç‚¹â€ï¼šåŒä¸€æ¡å‚è€ƒéŸ³é¢‘æå–çš„ speaker embeddingã€‚

### å¦‚ä½•åšåˆ°ï¼ˆå·¥ç¨‹ä¸Šï¼‰

ä½ å¯ä»¥ç”¨ä¸‹é¢ä¸‰æ¡è§„åˆ™ï¼ˆéå¸¸é€šç”¨ï¼‰ï¼š

1. **æ¯ç« å¼€å§‹ï¼šé‡æ–°æå– speaker embedding**
    
    - `spk = extract_spk_emb(ref_wav)`
        
2. **ä¸è¦è·¨ç« å¤ç”¨ç”Ÿæˆç¼“å­˜**
    
    - ä¸å¤ç”¨ KV cache / streaming state
        
3. **æ¯ç« ï¼ˆæˆ–æ¯æ®µï¼‰éƒ½æ˜¾å¼ä¼ å…¥åŒä¸€ä¸ª speaker embedding**
    
    - `tts(text, speaker_embedding=spk, ...)`
        

#### é€šç”¨ä¼ªä»£ç 

```python
ref = "speaker_ref.wav"

for chapter in chapters:
    spk = extract_spk_emb(ref)        # âœ… reset
    style = extract_style(ref)        # å¯é€‰ï¼šä¹Ÿ reset

    for para in chapter.paragraphs:
        audio = tts_generate(
            para,
            speaker_embedding=spk,
            style_embedding=style,
            use_kv_cache=False,       # âœ… ä¸è·¨æ®µå¤ç”¨ï¼ˆæˆ–æ¯ç« å…³é—­ï¼‰
        )
        save(audio)
```

> å¦‚æœä½ ç”¨çš„æ˜¯ CosyVoice/XTTS çš„å…·ä½“ APIï¼Œè´´ä¸€å°æ®µä½ ç°åœ¨çš„æ¨ç†ä»£ç ï¼ˆ20 è¡Œä»¥å†…å°±è¡Œï¼‰ï¼Œæˆ‘å¯ä»¥æŠŠâ€œresetâ€æ”¹æˆä½ é‚£å¥—åº“é‡Œ**ç¡®åˆ‡çš„å‚æ•°/å‡½æ•°å**ã€‚

---

## 3) â€œå›ºå®šéšæœºç§å­ï¼ˆé˜²æ¼‚ï¼‰â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚ä½•åšåˆ°ï¼Ÿ

### å®ƒæ˜¯ä»€ä¹ˆæ„æ€

å¾ˆå¤š token-based TTS ç”Ÿæˆ token æ—¶å¹¶ä¸æ˜¯â€œç¡®å®šæ€§â€çš„ï¼Œå°¤å…¶å½“ä½ ç”¨äº†ï¼š

- temperature
    
- top-k / top-p
    
- sampling
    

è¿™ä¼šå¯¼è‡´ï¼š

- åŒä¸€å¥è¯æ¯æ¬¡ç”Ÿæˆç•¥ä¸ä¸€æ ·
    
- é•¿æ–‡æœ¬æ—¶å·®å¼‚ç´¯ç§¯ â†’ è¡¨ç°ä¸ºéŸ³è‰²/æƒ…ç»ª/è¯­é€Ÿæ…¢æ…¢æ¼‚
    

**å›ºå®šéšæœºç§å­**çš„ç›®æ ‡æ˜¯ï¼š

> åœ¨ç›¸åŒè¾“å…¥ã€ç›¸åŒå‚æ•°ä¸‹ï¼Œæ¯æ¬¡ç”Ÿæˆç»“æœå°½é‡ä¸€è‡´ï¼ˆæˆ–è‡³å°‘æ›´ç¨³å®šï¼‰ã€‚

### æ€ä¹ˆåšï¼ˆä¸¤å±‚ï¼‰

#### A) æœ€å¼ºç¨³å®šï¼šå…³é—­é‡‡æ ·ï¼ˆç¡®å®šæ€§è§£ç ï¼‰

- temperature = 0ï¼ˆæˆ–æ¥è¿‘ 0ï¼‰
    
- do_sample = False
    
- ä½¿ç”¨ greedy / beamï¼ˆè‹¥æ”¯æŒï¼‰
    

è¿™é€šå¸¸å¯¹â€œé˜²æ¼‚â€æ¯”å•çº¯ seed æ›´æœ‰æ•ˆã€‚

#### B) ä»è¦é‡‡æ ·ï¼šå›ºå®š seed + å°½é‡ç¡®å®šæ€§

ä¸‹é¢æ˜¯ PyTorch å¸¸ç”¨æ¨¡æ¿ï¼š

```python
import os
import random
import numpy as np
import torch

def set_seed(seed: int = 1234):
    random.seed(seed)
    np.random.seed(seed)
    os.environ["PYTHONHASHSEED"] = str(seed)
    torch.manual_seed(seed)
    torch.cuda.manual_seed_all(seed)

    # å°½é‡ç¡®å®šæ€§ï¼ˆå¯èƒ½ä¼šç¨æ…¢ï¼›æŸäº›ç®—å­ä»å¯èƒ½éç¡®å®šï¼‰
    torch.use_deterministic_algorithms(True)
    torch.backends.cudnn.benchmark = False
    torch.backends.cudnn.deterministic = True

set_seed(1234)

# ç”Ÿæˆæ—¶å°½é‡ï¼šdo_sample=False æˆ– temperatureå¾ˆä½
audio = tts_generate(
    text,
    do_sample=False,      # âœ… æœ€ç¨³
    temperature=0.0,
)
```

### ä½ åº”è¯¥æ€ä¹ˆç»„åˆä½¿ç”¨ï¼ˆå»ºè®®ï¼‰

- **æœ‰å£°ä¹¦ä¸»çº¿é‡äº§**ï¼š  
    âœ… `do_sample=False` / `temperature=0`ï¼ˆæˆ–æä½ï¼‰ + å›ºå®š seed
    
- **éœ€è¦ä¸€ç‚¹è¡¨æ¼”æ„Ÿ/æƒ…ç»ªå˜åŒ–**ï¼š  
    âœ… å›ºå®š seed + å°æ¸©åº¦ï¼ˆæ¯”å¦‚ 0.2â€“0.5ï¼‰+ æ¯ç«  reset speaker/style  
    è¿™æ ·â€œå¯æ§åœ°å˜åŒ–â€ï¼Œä½†ä¸ä¼šä¹±æ¼‚
    

---

å¦‚æœä½ æŠŠä¸‹é¢ä¸¤ç‚¹å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥æŠŠâ€œreset embedding + å›ºå®š seedâ€å†™æˆ**ä½ æ­£åœ¨ç”¨çš„ CosyVoice æˆ– XTTS çš„å¯ç›´æ¥è¿è¡Œä»£ç **ï¼ˆä¸æ˜¯ä¼ªä»£ç ï¼‰ï¼š

1. ä½ ç”¨çš„æ¡†æ¶ï¼šCosyVoiceï¼ˆå“ªä¸ª repo/ç‰ˆæœ¬ï¼‰è¿˜æ˜¯ XTTSï¼Ÿ
    
2. ä½ ç°åœ¨æ¨ç†æ˜¯æ€æ ·è°ƒç”¨çš„ï¼ˆè´´è°ƒç”¨å‡½æ•°é‚£æ®µå³å¯ï¼‰ã€‚


# LLM tune-up

è¿™æ˜¯ä¸€ä¸ª**éå¸¸ä¸“ä¸šã€è€Œä¸”å…³é”®**çš„é—®é¢˜ã€‚ä¸‹é¢æˆ‘ç»™ä½ çš„æ˜¯**â€œä»¥æœ€é«˜è´¨é‡æœ‰å£°ä¹¦â€ä¸ºç›®æ ‡çš„å®æˆ˜çº§æ¨è**ï¼Œä¸æ˜¯è®ºæ–‡é‡Œé‚£ç§æ³›æ³›å‚æ•°ã€‚

æˆ‘ä¼šåˆ†ä¸‰å±‚æ¥è®²ï¼š

1. **å…ˆç»™ä½ ç›´æ¥å¯ç”¨çš„æœ€ä½³å‚æ•°è¡¨ï¼ˆç»“è®ºç‰ˆï¼‰**
    
2. **è§£é‡Šä¸ºä»€ä¹ˆ XTTS / CosyVoice / IndexTTS å¿…é¡»ç”¨ä¸åŒå‚æ•°**
    
3. **ä»€ä¹ˆæ—¶å€™è¯¥åç¦»è¿™äº›å‚æ•°ï¼ˆä»¥åŠåç¦»å¤šå°‘ï¼‰**
    

---

# ä¸€ã€æœ€é«˜è´¨é‡æœ‰å£°ä¹¦ï¼šæ¨èå‚æ•°ï¼ˆç»“è®ºç‰ˆï¼‰

> ç›®æ ‡å®šä¹‰ï¼š  
> **éŸ³è‰²ç¨³å®šã€é•¿æœŸä¸æ¼‚ã€è‡ªç„¶ä½†ä¸å¤¸å¼ ã€ç« èŠ‚ä¸€è‡´æ€§é«˜**  
> ï¼ˆä¸æ˜¯â€œè¡¨æ¼”æ„Ÿæœ€å¼ºâ€ï¼Œè€Œæ˜¯â€œå¯è¿ç»­å¬ 10 å°æ—¶ä¸ç–²åŠ³â€ï¼‰

## âœ… æ€»ä½“åŸåˆ™ï¼ˆéå¸¸é‡è¦ï¼‰

- **æœ‰å£°ä¹¦ â‰  èŠå¤© TTS**
    
- **ç¨³å®šæ€§ > éšæœºæ€§**
    
- **å®å¯ç•¥â€œä¿å®ˆâ€ï¼Œä¸è¦â€œçµæ„Ÿå‹â€é‡‡æ ·**
    

---

## 1ï¸âƒ£ XTTSï¼ˆtoken-basedï¼ŒLM å‘³è¾ƒå¼ºï¼‰

XTTS çš„å†…éƒ¨æ›´åƒã€Œè¯­éŸ³ token LMã€ï¼Œ**å¯¹é‡‡æ ·éå¸¸æ•æ„Ÿ**ã€‚

### ğŸ¯ æ¨èï¼ˆæœ‰å£°ä¹¦ä¸»çº¿ï¼‰

```text
do_sample = False        â† æœ€é‡è¦
temperature = 0.0
top_k = disabled
top_p = disabled
```

âœ… ç‰¹ç‚¹ï¼š

- éŸ³è‰²æœ€ç¨³å®š
    
- å‡ ä¹ä¸æ¼‚
    
- æƒ…ç»ªåä¸­æ€§ï¼Œä½†æœ€é€‚åˆé•¿å¬
    

### ğŸ§ è‹¥ä½ â€œå¿…é¡»â€è¦ä¸€ç‚¹è‡ªç„¶å˜åŒ–

```text
do_sample = True
temperature = 0.2
top_k = 40
top_p = 0.8
```

âš ï¸ ä¸è¦è¶…è¿‡ï¼š

- temperature > 0.3
    
- top_p > 0.9  
    å¦åˆ™**ç« èŠ‚çº§å¿…æ¼‚**
    

---

## 2ï¸âƒ£ CosyVoice / CosyVoice FTï¼ˆtoken-basedï¼Œä½†å£°å­¦çº¦æŸæ›´å¼ºï¼‰

CosyVoice **æ¯” XTTS æ›´â€œç¨³â€**ï¼Œå¯ä»¥å®¹å¿ä¸€ç‚¹ç‚¹é‡‡æ ·ã€‚

### ğŸ¯ æ¨èï¼ˆæœ‰å£°ä¹¦æœ€ä½³å¹³è¡¡ç‚¹ï¼‰

```text
do_sample = True
temperature = 0.3
top_k = 50
top_p = 0.85
```

è¿™æ˜¯æˆ‘**æœ€æ¨èçš„ audiobook é…ç½®**ã€‚

âœ… ç‰¹ç‚¹ï¼š

- æ¯” XTTS æ›´è‡ªç„¶
    
- ä¸å®¹æ˜“æ¼‚éŸ³è‰²
    
- è½»å¾® prosody å˜åŒ–ä½†å¯æ§
    

### ğŸ§ æç«¯ç¨³å®šï¼ˆå¹¿æ’­çº§ï¼‰

```text
do_sample = False
temperature = 0.0
```

ç”¨äºï¼š

- æ•™æ
    
- çºªå®
    
- æŠ€æœ¯ä¹¦
    

---

## 3ï¸âƒ£ IndexTTSï¼ˆtoken-free / è¿ç»­å£°å­¦ï¼‰

IndexTTS æœ¬è´¨ä¸Š**ä¸æ˜¯é  token é‡‡æ ·â€œå‘æŒ¥åˆ›æ„â€**ï¼Œè€Œæ˜¯é è¿ç»­å£°å­¦å»ºæ¨¡ã€‚

ğŸ‘‰ æ‰€ä»¥ **temperature / top-k / top-p åŸºæœ¬â€œä¸æ˜¯æ ¸å¿ƒæ—‹é’®â€**

### ğŸ¯ æ¨èï¼ˆæœ€é«˜è´¨é‡ï¼‰

```text
temperature = N/A æˆ– 0.7â€“1.0ï¼ˆè‹¥å­˜åœ¨ï¼‰
top_k / top_p = N/A
```

çœŸæ­£å½±å“ IndexTTS çš„æ˜¯ï¼š

- å‚è€ƒéŸ³é¢‘è´¨é‡
    
- æ‰©æ•£ / flow æ­¥æ•°
    
- guidance / CFG scaleï¼ˆå¦‚æœæœ‰ï¼‰
    

ğŸ‘‰ **ä¸è¦è¯•å›¾ç”¨ token LM çš„æ€è·¯è°ƒ IndexTTS**

---

# äºŒã€ä¸ºä»€ä¹ˆä¸‰è€…å¿…é¡»ç”¨ä¸åŒçš„å€¼ï¼Ÿï¼ˆåŸç†å±‚ï¼‰

### XTTS

- è¯­è¨€æ¨¡å‹å‘³é‡
    
- token åˆ†å¸ƒâ€œå‘æ•£â€
    
- sampling ä¸€å¼€ï¼Œæ¼‚ç§»ä¼š**ç´¯ç§¯**
    

ğŸ‘‰ æ‰€ä»¥ï¼š**è¶Šç¡®å®šæ€§è¶Šå¥½**

---

### CosyVoice

- å£°å­¦çº¦æŸæ›´å¼º
    
- token æ›´â€œè´´è¿‘å£°å­¦è½¨é“â€
    
- sampling å½±å“è¾ƒæ¸©å’Œ
    

ğŸ‘‰ æ‰€ä»¥ï¼š**å¯ä»¥å°å¹…é‡‡æ ·ï¼Œæ¢è‡ªç„¶åº¦**

---

### IndexTTS

- è¿ç»­å£°å­¦ï¼ˆä¸æ˜¯ç¦»æ•£ token å†³ç­–ï¼‰
    
- â€œéšæœºæ€§â€æ›´å¤šä½“ç°åœ¨å™ªå£°åˆå€¼ / æ‰©æ•£è¿‡ç¨‹
    
- æ²¡æœ‰ top-k / top-p è¿™ç§ LM æ¦‚å¿µ
    

ğŸ‘‰ æ‰€ä»¥ï¼š**æ§åˆ¶æ–¹å¼å®Œå…¨ä¸åŒ**

---

# ä¸‰ã€ä»€ä¹ˆæ—¶å€™ä½ è¯¥åç¦»è¿™äº›â€œæœ€ä½³å€¼â€ï¼Ÿ

## æƒ…å†µ 1ï¼šå°è¯´äººç‰©å¯¹ç™½ï¼Œéœ€è¦ä¸€ç‚¹è¡¨æ¼”æ„Ÿ

**å»ºè®®ï¼š**

- åªåœ¨â€œå¯¹ç™½æ®µè½â€ä½¿ç”¨ç•¥é«˜ temperature
    
- æ—ç™½ä»ç”¨ä¿å®ˆå‚æ•°
    

ä¾‹å¦‚ CosyVoiceï¼š

```text
æ—ç™½ï¼š
temperature = 0.3
top_p = 0.85

å¯¹ç™½ï¼š
temperature = 0.45
top_p = 0.9
```

âš ï¸ ä¸è¦æ•´ç« ç”¨é«˜å€¼

---

## æƒ…å†µ 2ï¼šä½ å·²ç»åšäº† Fine-Tune

> **Fine-tune â‰  å¯ä»¥éšä¾¿åŠ  temperature**

Fine-tune åï¼š

- **éŸ³è‰²æ›´ç¨³**
    
- ä½†**é‡‡æ ·æ¼‚ç§»ä»ç„¶å­˜åœ¨**
    

å»ºè®®ï¼š

- CosyVoice FTï¼štemperature +0.05ï½0.1 ä»¥å†…
    
- XTTS FTï¼šä»å»ºè®® do_sample=False ä½œä¸ºä¸»çº¿
    

---

## æƒ…å†µ 3ï¼šä½ è¦åšâ€œæ ·ç«  / è¯•å¬â€

å¯ä»¥ç‰ºç‰²ä¸€ç‚¹ä¸€è‡´æ€§æ¢æ„ŸæŸ“åŠ›ï¼š

```text
temperature = 0.5
top_p = 0.9
```

ä½†**ç»ä¸ç”¨äºæ•´æœ¬ä¹¦**

---

# å››ã€æœ€ç»ˆæ¨èï¼ˆç›´æ¥ç…§æŠ„ç”¨ï¼‰

## ğŸ“˜ æœ‰å£°ä¹¦ä¸»çº¿ï¼ˆæˆ‘æœ€æ¨èï¼‰

|æ¨¡å‹|temperature|top-k|top-p|å¤‡æ³¨|
|---|---|---|---|---|
|XTTS|0.0|off|off|æœ€ç¨³|
|CosyVoice|0.3|50|0.85|**æœ€ä½³å¹³è¡¡**|
|IndexTTS|N/A|N/A|N/A|è°ƒæ­¥æ•°/CFG|

---

## ğŸ“• æœ‰å£°ä¹¦å¯¹ç™½å¢å¼ºï¼ˆå¯é€‰ï¼‰

|æ¨¡å‹|temperature|top-p|
|---|---|---|
|XTTS|0.2|0.8|
|CosyVoice|0.4â€“0.45|0.9|

---

ä¸‹é¢æˆ‘æŒ‰â€œ**å®ƒæ§åˆ¶ä»€ä¹ˆ â†’ å…¸å‹å‰¯ä½œç”¨ â†’ æœ‰å£°ä¹¦æ€ä¹ˆè°ƒ â†’ ç»™ä½ ä¸€å¥—å¯ç›´æ¥å¥—ç”¨çš„å»ºè®®èŒƒå›´**â€æ¥è®²ã€‚ä½ å…³å¿ƒçš„æ˜¯**é«˜è´¨é‡æœ‰å£°ä¹¦**ï¼Œæ‰€ä»¥æˆ‘ä¼šæŠŠé‡ç‚¹æ”¾åœ¨**ç¨³å®šã€ä¸å¡é¡¿ã€ä¸æ¼‚éŸ³è‰²**ä¸Šã€‚

---

# ä¸€ã€ä¸‰å¤§é‡‡æ ·å‚æ•°ï¼štemperature / top-p / top-k

è¿™ä¸‰è€…åªåœ¨ **do_sample=Trueï¼ˆå¯ç”¨é‡‡æ ·ï¼‰** æ—¶çœŸæ­£èµ·ä½œç”¨ï¼›å¦‚æœä½ ç”¨ **do_sample=Falseï¼ˆè´ªå©ª/ç¡®å®šæ€§ï¼‰**ï¼Œå®ƒä»¬åŸºæœ¬ä¸ç”Ÿæ•ˆã€‚

## 1) Temperatureï¼ˆæ¸©åº¦ï¼‰

### å®ƒæ§åˆ¶ä»€ä¹ˆ

æŠŠæ¨¡å‹è¾“å‡ºçš„ token æ¦‚ç‡åˆ†å¸ƒâ€œå˜å°–/å˜å¹³â€ï¼š

- **ä½æ¸©åº¦ï¼ˆ<0.3ï¼‰**ï¼šåˆ†å¸ƒæ›´å°–ï¼Œæ¨¡å‹æ›´â€œä¿å®ˆâ€ï¼Œæ›´å€¾å‘é€‰æœ€å¯èƒ½çš„ token
    
- **é«˜æ¸©åº¦ï¼ˆ>0.7ï¼‰**ï¼šåˆ†å¸ƒæ›´å¹³ï¼Œæ¨¡å‹æ›´â€œæ”¾é£â€ï¼Œæ›´å®¹æ˜“é€‰åˆ°ä½æ¦‚ç‡ token
    

ç›´è§‰ï¼š

> æ¸©åº¦è¶Šé«˜ï¼Œè¶Šåƒâ€œå…è®¸å³å…´å‘æŒ¥â€ï¼›æ¸©åº¦è¶Šä½ï¼Œè¶Šåƒâ€œç…§ç¨¿å¿µâ€ã€‚

### å‰¯ä½œç”¨ï¼ˆä½ ä¼šå¬åˆ°ä»€ä¹ˆï¼‰

- æ¸©åº¦å¤ªé«˜ï¼š
    
    - éŸ³è‰²/æƒ…ç»ªæ³¢åŠ¨æ›´å¤§ï¼ˆ**æ¼‚éŸ³è‰²**æ¦‚ç‡ä¸Šå‡ï¼‰
        
    - æ–­å¥æ›´éšæœºï¼Œå¶å‘æ€ªåœé¡¿
        
    - ç”šè‡³å‡ºç°ä¸ªåˆ«å‘éŸ³æ€ªã€åå­—
        
- æ¸©åº¦å¤ªä½ï¼š
    
    - è¯­æ°”æ›´å¹³ã€è¡¨æ¼”æ„Ÿæ›´å¼±
        
    - æœ‰æ—¶â€œå¤ªè§„æ•´â€ç•¥åƒæ’­æŠ¥
        

### æœ‰å£°ä¹¦æ€ä¹ˆè°ƒï¼ˆæ¨èï¼‰

- **æ—ç™½ï¼ˆé•¿ç¯‡ç¨³å®šï¼‰**ï¼š`0.0 ~ 0.3`
    
- **å¯¹ç™½ï¼ˆéœ€è¦ä¸€ç‚¹çµåŠ¨ï¼‰**ï¼š`0.3 ~ 0.5`
    
- **æ•´æœ¬ä¹¦ä¸å»ºè®®è¶…è¿‡**ï¼š`0.5`
    

> å¯¹ XTTSï¼šæ›´æ•æ„Ÿï¼Œé€šå¸¸è¦æ¯” CosyVoice å†ä¿å®ˆä¸€æ¡£ã€‚

---

## 2) Top-pï¼ˆæ ¸é‡‡æ · / Nucleus samplingï¼‰

### å®ƒæ§åˆ¶ä»€ä¹ˆ

ä»æ¦‚ç‡æœ€é«˜çš„ token å¾€ä¸‹ç´¯è®¡ï¼Œç›´åˆ°ç´¯è®¡æ¦‚ç‡è¾¾åˆ° **p**ï¼Œç„¶å**åªåœ¨è¿™ä¸ªé›†åˆé‡ŒæŠ½æ ·**ã€‚

- **top_p=0.8**ï¼šåªåœ¨â€œæœ€å¯èƒ½çš„ä¸€å°æ’® tokenâ€é‡ŒæŠ½
    
- **top_p=0.95**ï¼šå€™é€‰èŒƒå›´å¤§å¾ˆå¤šï¼ˆéšæœºæ€§å¼ºå¾ˆå¤šï¼‰
    

ç›´è§‰ï¼š

> top_p åƒâ€œå…è®¸çš„å¤‡é€‰ç­”æ¡ˆæ± â€å¤§å°ï¼ˆæŒ‰æ¦‚ç‡è´¨é‡ç®—ï¼‰ã€‚

### å‰¯ä½œç”¨

- top_p å¤ªå¤§ï¼ˆ>0.9ï¼‰ï¼š
    
    - å€™é€‰æ± å˜å¤§ â†’ æ›´éšæœº â†’ æ›´å®¹æ˜“æ¼‚
        
    - æ›´å®¹æ˜“å‡ºâ€œå¥‡æ€ª tokenâ€å¯¼è‡´å‘éŸ³/èŠ‚å¥å¶å‘å¼‚å¸¸
        
- top_p å¤ªå°ï¼ˆ<0.75ï¼‰ï¼š
    
    - å€™é€‰æ± è¿‡å° â†’ å¯èƒ½å˜å¾—æ›´æ­»æ¿
        
    - æœ‰æ—¶ä¼šå‡ºç°é‡å¤ã€èŠ‚å¥åƒµç¡¬ï¼ˆçœ‹æ¨¡å‹ï¼‰
        

### æœ‰å£°ä¹¦æ€ä¹ˆè°ƒï¼ˆæ¨èï¼‰

- **ç¨³æ€æ—ç™½**ï¼š`0.80 ~ 0.88`
    
- **å¯¹ç™½**ï¼š`0.88 ~ 0.92`ï¼ˆä¸è¦é•¿æœŸç”¨ï¼‰
    
- **XTTS é€šå¸¸å»ºè®® â‰¤ 0.85**ï¼ˆæ›´ç¨³ï¼‰
    

---

## 3) Top-k

### å®ƒæ§åˆ¶ä»€ä¹ˆ

åªä¿ç•™æ¦‚ç‡æœ€é«˜çš„ **k ä¸ª token**ï¼Œåœ¨å…¶ä¸­æŠ½æ ·ã€‚

- **k=40**ï¼šåªå…è®¸å‰ 40 ä¸ªå€™é€‰
    
- **k=0/None**ï¼šä¸é™åˆ¶ï¼ˆå®Œå…¨ç”± top_p æˆ–æ¸©åº¦ä¸»å¯¼ï¼‰
    

ç›´è§‰ï¼š

> top_k æ˜¯â€œç¡¬åˆ‡â€çš„å€™é€‰æ•°é‡ä¸Šé™ã€‚

### å‰¯ä½œç”¨

- top_k å¤ªå¤§ï¼šçº¦ç­‰äºæ²¡é™ï¼ˆéšæœºæ€§å›æ¥äº†ï¼‰
    
- top_k å¤ªå°ï¼ˆ<20ï¼‰ï¼š
    
    - å¯èƒ½å˜å¾—è¿‡äºå•ä¸€ã€é‡å¤
        
    - æŸäº›æƒ…å†µä¸‹ä¼šå½±å“è‡ªç„¶æ€§
        

### æœ‰å£°ä¹¦æ€ä¹ˆè°ƒï¼ˆæ¨èï¼‰

- **ç¨³æ€æ—ç™½**ï¼š`top_k = 30 ~ 60`
    
- **å¯¹ç™½**ï¼š`top_k = 50 ~ 100`
    
- å¯¹ XTTSï¼š`30~50` å¸¸å¸¸æ¯”è¾ƒå®‰å…¨
    

> å®åŠ¡ä¸Šï¼š**top_p é€šå¸¸æ›´å…³é”®**ï¼Œtop_k åªæ˜¯â€œå†åŠ ä¸€é“ä¿é™©â€ã€‚

---

# äºŒã€XTTS å¸¸è§çš„é¢å¤–å‚æ•°ï¼šlength_penalty / repetition_penalty / num_beams

è¿™ä¸‰ä¸ªæ›´åƒ NLP è§£ç å™¨çš„å‚æ•°ï¼Œä¸»è¦å½±å“ **â€œç”Ÿæˆ token åºåˆ—çš„åå¥½â€**ï¼Œä»è€Œé—´æ¥å½±å“è¯­é€Ÿ/åœé¡¿/é‡å¤/ç¨³å®šæ€§ã€‚

> æ³¨æ„ï¼šä¸åŒ XTTS å®ç°ï¼ˆrepo/ç‰ˆæœ¬ï¼‰å¯¹è¿™äº›å‚æ•°çš„â€œå®é™…ä½œç”¨å¼ºåº¦â€å¯èƒ½ä¸åŒï¼Œä½†è°ƒå‚é€»è¾‘ç›¸åŒã€‚

---

## 1) num_beamsï¼ˆæŸæœç´¢ï¼‰

### å®ƒæ§åˆ¶ä»€ä¹ˆ

å½“ **do_sample=False** æ—¶ï¼Œæ¨¡å‹å¯ä»¥ç”¨ beam searchï¼š  
åŒæ—¶ä¿ç•™å¤šä¸ªå€™é€‰åºåˆ—ï¼Œæœ€åé€‰ä¸€ä¸ªæ•´ä½“æ¦‚ç‡æ›´é«˜çš„ã€‚

- `num_beams=1`ï¼šè´ªå©ªè§£ç ï¼ˆæœ€å¿«ï¼Œæœ€ç¡®å®šï¼‰
    
- `num_beams>1`ï¼šæ›´â€œå…¨å±€æœ€ä¼˜â€ï¼Œä½†æ›´æ…¢
    

### æœ‰å£°ä¹¦å½±å“

- beam å¢å¤§ï¼š
    
    - æ–‡æœ¬ä¸€è‡´æ€§é€šå¸¸æ›´å¥½ä¸€ç‚¹
        
    - ä½† **é€Ÿåº¦ä¸‹é™æ˜æ˜¾**
        
    - æœ‰æ—¶ä¼šæ›´â€œä¹¦é¢/å¹³â€ï¼Œè¡¨æ¼”æ„Ÿä¸‹é™
        

### æ¨è

- **æœ‰å£°ä¹¦æ‰¹é‡**ï¼š`num_beams = 1`ï¼ˆé¦–é€‰ï¼‰
    
- **ä½ å‘ç°å¶å‘åå­—/æ–­å¥æ€ª**ï¼šè¯• `num_beams = 2~4`
    
- ä¸å»ºè®®è¶…è¿‡ 4ï¼ˆæ”¶ç›Šå°ã€æˆæœ¬é«˜ï¼‰
    

---

## 2) length_penaltyï¼ˆé•¿åº¦æƒ©ç½š/åå¥½ï¼‰

### å®ƒæ§åˆ¶ä»€ä¹ˆ

å½±å“ beam search æ—¶å¯¹â€œé•¿/çŸ­è¾“å‡ºåºåˆ—â€çš„åå¥½ï¼š

- **>1**ï¼šé¼“åŠ±æ›´é•¿åºåˆ—ï¼ˆä¸æ˜“æ—©åœï¼‰
    
- **<1**ï¼šé¼“åŠ±æ›´çŸ­åºåˆ—ï¼ˆæ›´æ˜“æ—©åœï¼‰
    

> åœ¨çº¯æ–‡æœ¬ç”Ÿæˆé‡Œå®ƒå½±å“â€œå›ç­”é•¿çŸ­â€ï¼›åœ¨ TTS token ç”Ÿæˆé‡Œï¼Œå®ƒå¯èƒ½å½±å“â€œæ—¶é•¿/åœé¡¿/æ˜¯å¦æ—©æ”¶å°¾â€ã€‚

### æœ‰å£°ä¹¦æ€ä¹ˆç”¨

- å¦‚æœä½ é‡åˆ°ï¼š
    
    - å¥å°¾è¢«æå‰æ”¶æ‰ï¼ˆå°¾éŸ³çŸ­ã€å¥å·æ²¡è¯»å®Œçš„æ„Ÿè§‰ï¼‰
        
    - è¯­éŸ³è¿‡çŸ­ã€åœé¡¿ä¸å¤Ÿ  
        â†’ **ç•¥å¾®è°ƒå¤§**ï¼ˆå¦‚ 1.05~1.2ï¼‰
        
- å¦‚æœä½ é‡åˆ°ï¼š
    
    - å¥å­æ‹–æ²“ã€åœé¡¿è¿‡é•¿  
        â†’ **ç•¥å¾®è°ƒå°**ï¼ˆå¦‚ 0.9~0.98ï¼‰
        

### æ¨èèŒƒå›´ï¼ˆè°¨æ…ï¼‰

- å¸¸ç”¨å®‰å…¨åŒºï¼š`0.95 ~ 1.15`
    
- é»˜è®¤å…ˆç”¨ï¼š`1.0`
    

---

## 3) repetition_penaltyï¼ˆé‡å¤æƒ©ç½šï¼‰

### å®ƒæ§åˆ¶ä»€ä¹ˆ

æƒ©ç½šâ€œåˆšç”Ÿæˆè¿‡çš„ token å†å‡ºç°â€ã€‚  
ç”¨äºæŠ‘åˆ¶ï¼š

- è¯è¯­é‡å¤
    
- è¯­éŸ³ token å¾ªç¯ï¼ˆæç«¯ä¼šå˜æˆâ€œå¡ä½â€ï¼‰
    

### å‰¯ä½œç”¨

- å¤ªå°ï¼ˆæ¥è¿‘ 1.0 æˆ–æ— æƒ©ç½šï¼‰ï¼šæœ‰æ—¶ä¼šå‡ºç°é‡å¤ã€å£åƒæ ·å¾ªç¯ï¼ˆæŸäº›æ–‡æœ¬/é‡‡æ ·è®¾ç½®ä¸‹ï¼‰
    
- å¤ªå¤§ï¼ˆ>1.2~1.3ï¼‰ï¼šå¯èƒ½å¯¼è‡´æ¨¡å‹ä¸æ•¢ç”¨å¸¸è§ token â†’ å‘éŸ³/èŠ‚å¥å˜æ€ªï¼Œç”šè‡³å½±å“éŸ³è‰²ç¨³å®š
    

### æ¨è

- **æœ‰å£°ä¹¦ä¸»çº¿**ï¼š`1.05 ~ 1.15`
    
- å‡ºç°æ˜æ˜¾é‡å¤/å¾ªç¯ï¼šé€æ­¥ä¸Šè°ƒåˆ° `1.18` å·¦å³è¯•è¯•
    
- ä¸å»ºè®®é•¿æœŸ > `1.2`
    

---

# ä¸‰ã€ç»™ä½ ä¸€å¥—â€œæœ‰å£°ä¹¦æœ€ç¨³å‚æ•°æ¨¡æ¿â€ï¼ˆXTTS ä¼˜å…ˆï¼‰

## æ¨¡æ¿ Aï¼šå¹¿æ’­çº§ç¨³å®šï¼ˆæˆ‘æœ€æ¨èåšæ•´ä¹¦ä¸»çº¿ï¼‰

```text
do_sample = False
num_beams = 1
# temperature/top_k/top_p æ— æ•ˆæˆ–å¿½ç•¥
repetition_penalty = 1.10
length_penalty = 1.0
```

## æ¨¡æ¿ Bï¼šä¿®å¤å¶å‘åå­—/æ–­å¥æ€ªï¼ˆç‰ºç‰²ä¸€ç‚¹é€Ÿåº¦ï¼‰

```text
do_sample = False
num_beams = 2~4
repetition_penalty = 1.10
length_penalty = 1.05
```

## æ¨¡æ¿ Cï¼šå¯¹ç™½ç¨å¾®çµåŠ¨ï¼ˆä¸è¦æ•´ç« ç”¨ï¼‰

```text
do_sample = True
temperature = 0.2~0.3
top_p = 0.8~0.85
top_k = 40~50
repetition_penalty = 1.08~1.12
num_beams = 1  # é‡‡æ ·æ—¶ä¸€èˆ¬ä¸é…beam
length_penalty = 1.0
```

---

# å››ã€æ€ä¹ˆè°ƒï¼šä¸€ä¸ªéå¸¸å®ç”¨çš„â€œè°ƒå‚é¡ºåºâ€

å½“ä½ å¬åˆ°é—®é¢˜æ—¶ï¼Œä¸è¦ä¹±æ‹§æ—‹é’®ï¼ŒæŒ‰è¿™ä¸ªé¡ºåºï¼š

1. **å…ˆå†³å®šï¼šdo_sample=False è¿˜æ˜¯ True**
    

- æ•´ä¹¦ï¼šå…ˆç”¨ False
    
- å¯¹ç™½ï¼šæ‰è€ƒè™‘ True
    

2. **å…ˆä¿®é‡å¤**
    

- `repetition_penalty` ä» 1.05 å¾€ä¸ŠåŠ åˆ° 1.15ï¼ˆå°æ­¥ 0.02ï¼‰
    

3. **å†ä¿®æ–­å¥/å°¾éŸ³**
    

- `length_penalty` åœ¨ 0.95~1.15 å¾®è°ƒï¼ˆå°æ­¥ 0.03~0.05ï¼‰
    

4. **æœ€åæ‰åŠ¨ temperature/top_p/top_k**
    

- ä¸€æ—¦å‘ç°â€œæ¼‚éŸ³è‰²â€ï¼Œå…ˆæŠŠï¼š
    
    - temperature â†“
        
    - top_p â†“
        
    - æˆ–ç›´æ¥ do_sample=False
        

---

å¦‚æœä½ æŠŠä½ ç°åœ¨ XTTS çš„å®é™…è°ƒç”¨å‚æ•°è´´å‡ºæ¥ï¼ˆå“ªæ€• 10 è¡Œï¼‰ï¼Œæˆ‘å¯ä»¥æŒ‰ä½ é‚£ä»½ APIï¼ˆæœ‰çš„å« `generation_config`ï¼Œæœ‰çš„å« `gpt_cond_len`/`enable_text_splitting` ç­‰ï¼‰ç»™ä½ å†™ä¸€ä»½**å®Œå…¨å¯¹åº”ä½ ä»£ç çš„æ¨èé…ç½®**ï¼Œå¹¶å‘Šè¯‰ä½ æ¯ä¸ªå‚æ•°åº”è¯¥æ”¾åœ¨å“ªä¸ªå­—æ®µé‡Œã€‚


# bark

ç®€çŸ­ç»“è®ºå…ˆç»™ä½ ä¸€å¥**éå¸¸å®åœ¨çš„è¯**ï¼š

> **ä¸ä¼šã€‚æŠŠ XTTS æ¢æˆ Barkï¼Œé‡å¤/åå­—é—®é¢˜å¤§æ¦‚ç‡ä¸ä¼šæ›´å¥½ï¼Œåè€Œæ›´å¯èƒ½åœ¨â€œæœ‰å£°ä¹¦â€åœºæ™¯é‡Œå˜å·®ã€‚**

ä¸‹é¢æˆ‘æŠŠ**ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€é—®é¢˜çš„æ ¹å› æ˜¯ä»€ä¹ˆã€ä»¥åŠçœŸæ­£å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ**ç»™ä½ å½»åº•æ‹†æ¸…æ¥šã€‚

---

## ä¸€ã€XTTS çš„â€œé‡å¤ / åå­—â€æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿï¼ˆæœ¬è´¨åŸå› ï¼‰

ä½ é‡åˆ°çš„è¿™ä¸¤ç±»é—®é¢˜ï¼Œæœ¬è´¨éƒ½ä¸æ˜¯â€œæ¨¡å‹å¤ªå·®â€ï¼Œè€Œæ˜¯ **token-based è¯­éŸ³ç”Ÿæˆåœ¨é•¿æ–‡æœ¬ä¸Šçš„å…¸å‹å¤±è´¥æ¨¡å¼**ã€‚

### 1ï¸âƒ£ é‡å¤ï¼ˆloop / stutterï¼‰

å¸¸è§è¡¨ç°ï¼š

- æŸä¸ªè¯æˆ–éŸ³èŠ‚åå¤å‡ºç°
    
- å¥å°¾å¡ä½ã€æ‹–é•¿ã€é‡å¤
    
- æƒ…ç»ªè¯åå¤
    

**æ ¹å› ï¼š**

- è¯­è¨€æ¨¡å‹åœ¨è¯­éŸ³ token ç©ºé—´é‡Œ**è¿›å…¥å±€éƒ¨æœ€ä¼˜å¾ªç¯**
    
- temperature / top-p åé«˜
    
- repetition_penalty ä¸å¤Ÿ
    
- é•¿ä¸Šä¸‹æ–‡ç´¯ç§¯ï¼ˆKV cache / é•¿å¥ï¼‰
    

---

### 2ï¸âƒ£ åå­— / æ‰éŸ³

å¸¸è§è¡¨ç°ï¼š

- å¥å°¾çªç„¶æ”¶æ‰
    
- ä¸­é—´å°‘è¯»ä¸€ä¸ªå­—
    
- åœé¡¿ä½ç½®ä¸å¯¹
    

**æ ¹å› ï¼š**

- ç”Ÿæˆæå‰ EOS
    
- length_penalty åå°
    
- beam / greedy è§£ç å¯¹â€œçŸ­è·¯å¾„â€åå¥½
    
- è¾“å…¥å¥å­è¿‡é•¿ã€æ ‡ç‚¹ä¸è§„èŒƒ
    

---

## äºŒã€é‚£ Bark ä¼šä¸ä¼šâ€œå¤©ç”Ÿæ›´å¥½â€ï¼Ÿ

### ç»“è®ºï¼š**ä¸ä¼šï¼ŒåŸå› å¦‚ä¸‹**

---

## 1ï¸âƒ£ Bark çš„æ¶æ„ï¼Œå†³å®šäº†å®ƒä¸é€‚åˆâ€œç¨³å®šæœ‰å£°ä¹¦â€

Bark çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼š

> **â€œæƒ…ç»ªåŒ–ã€å³å…´ã€å¤šæ ·æ€§ã€çŸ­éŸ³é¢‘ç”Ÿæˆâ€**

è€Œä¸æ˜¯ï¼š

> **â€œå‡ åä¸‡å­—ã€éŸ³è‰²ç¨³å®šã€å¯é¢„æµ‹çš„ audiobookâ€**

### Bark çš„å…¸å‹é—®é¢˜

- âŒ éŸ³è‰²ä¸€è‡´æ€§ **æ˜æ˜¾å·®äº XTTS**
    
- âŒ é•¿æ–‡æœ¬éå¸¸å®¹æ˜“ï¼š
    
    - éŸ³è‰²æ¼‚
        
    - æƒ…ç»ªçªç„¶å˜
        
    - è¯­é€Ÿä¸ä¸€è‡´
        
- âŒ å¯¹ä¸­æ–‡æ”¯æŒæœ¬æ¥å°±ä¸å¦‚ XTTS / CosyVoice
    

ğŸ‘‰ ä½ ç°åœ¨é‡åˆ°çš„ XTTS é—®é¢˜ï¼Œ**åœ¨ Bark é‡Œå¹¶ä¸ä¼šæ¶ˆå¤±ï¼Œåªæ˜¯â€œæ¢ä¸€ç§å½¢å¼å‡ºç°â€**ã€‚

---

## 2ï¸âƒ£ Bark æ›´â€œæ•¢å‘æŒ¥â€ï¼Œä½†è¿™æ­£æ˜¯ audiobook çš„æ•Œäºº

Bark çš„ token è®¾è®¡ï¼š

- æƒ…ç»ª token å¾ˆå¼º
    
- éç¡®å®šæ€§éå¸¸é«˜
    
- sampling æ˜¯â€œæ ¸å¿ƒå–ç‚¹â€
    

è¿™æ„å‘³ç€ï¼š

- **çŸ­å¥ demo å¾ˆæƒŠè‰³**
    
- **é•¿ç¯‡ç”Ÿæˆæä¸ç¨³å®š**
    

ğŸ‘‰ å¯¹å°è¯´/æ—ç™½æ¥è¯´ï¼Œè¿™åè€Œæ˜¯ç¾éš¾ã€‚

---

## ä¸‰ã€ä¸ºä»€ä¹ˆä½ ä¼šâ€œæ„Ÿè§‰ Bark å¥½åƒæ²¡é‚£ä¹ˆé‡å¤â€ï¼Ÿï¼ˆé”™è§‰æ¥æºï¼‰

å¾ˆå¤šäººæœ‰è¿™ç§æ„Ÿè§‰ï¼ŒåŸå› é€šå¸¸æ˜¯ï¼š

1. **æµ‹è¯•æ–‡æœ¬å¤ªçŸ­**
    
    - Bark åœ¨ 1â€“2 å¥å†…ä¸å®¹æ˜“å‡º loop
        
2. **æ²¡æœ‰ä¸¥æ ¼å¯¹æ¯”â€œåŒä¸€å¥è¯å¤šæ¬¡ç”Ÿæˆâ€**
    
3. **å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸åŒ**
    
    - Bark çš„â€œå˜åŒ–â€æ©ç›–äº†â€œé”™è¯¯â€
        

ä¸€æ—¦ä½ ï¼š

- ç”¨ 10 åˆ†é’Ÿä»¥ä¸Šçš„è¿ç»­æ–‡æœ¬
    
- è¦æ±‚éŸ³è‰²ä¸€è‡´
    
- è¦æ±‚æ–­å¥å‡†ç¡®
    

ğŸ‘‰ Bark çš„é—®é¢˜ä¼šæ¯” XTTS **æ›´æ—©ã€æ›´æ˜æ˜¾**ã€‚

---

## å››ã€çœŸæ­£è¯¥æ€ä¹ˆè§£å†³ XTTS çš„é‡å¤ / åå­—ï¼Ÿï¼ˆå¯è½åœ°ï¼‰

### âœ… æ–¹æ¡ˆä¸€ï¼šå‚æ•°çº§æ­¢è¡€ï¼ˆç«‹åˆ»æœ‰æ•ˆï¼‰

è¿™æ˜¯**ä½ ç°åœ¨æœ€è¯¥å…ˆåšçš„**ã€‚

#### ğŸ”§ æ¨èç¨³å®šé…ç½®ï¼ˆæœ‰å£°ä¹¦ä¸»çº¿ï¼‰

```text
do_sample = False
num_beams = 1
repetition_penalty = 1.12
length_penalty = 1.05
```

> è¿™ç»„å‚æ•°åœ¨ **90% audiobook åœºæ™¯**ä¸‹ï¼š

- é‡å¤ä¼šæ˜æ˜¾ä¸‹é™
    
- åå­—æ¦‚ç‡æ˜¾è‘—é™ä½
    
- éŸ³è‰²æœ€ç¨³å®š
    

å¦‚æœä»æœ‰å¶å‘é—®é¢˜ï¼š

```text
num_beams = 2
```

ï¼ˆåªç‰ºç‰²ä¸€ç‚¹é€Ÿåº¦ï¼‰

---

### âœ… æ–¹æ¡ˆäºŒï¼šæ–‡æœ¬å±‚â€œé˜²çˆ†â€å¤„ç†ï¼ˆéå¸¸å…³é”®ï¼‰

XTTS å¯¹**æ–‡æœ¬è´¨é‡æå…¶æ•æ„Ÿ**ã€‚

**ä½ å¿…é¡»åšåˆ°ï¼š**

- å¥é•¿æ§åˆ¶åœ¨ **35â€“90 å­—**
    
- æ ‡ç‚¹è§„èŒƒï¼ˆå¥å·ä¸€å®šè¦æœ‰ï¼‰
    
- æ•°å­—å…¨éƒ¨è½¬ä¸­æ–‡
    
- ä¸è¦æ•´ç« ä¸€æ¬¡æ€§å–‚è¿›å»
    

ğŸ‘‰ ä½ å‰é¢è¦çš„ **ä¸­æ–‡ audiobook æ¸…æ´—è„šæœ¬**ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€å±‚é—®é¢˜ã€‚

---

### âœ… æ–¹æ¡ˆä¸‰ï¼šç« èŠ‚çº§ resetï¼ˆé˜²ç´¯ç§¯é”™è¯¯ï¼‰

ä½ è¦**é¿å…é•¿é“¾å¼ç”Ÿæˆ**ï¼š

âŒ é”™è¯¯åšæ³•ï¼š

```text
æ•´ç«  â†’ ä¸€æ¬¡ç”Ÿæˆ
```

âœ… æ­£ç¡®åšæ³•ï¼š

```text
æ¯æ®µç”Ÿæˆ
æ¯ç«  reset speaker embedding
æ¯ç« ä¸å¤ç”¨ cache
```

è¿™ä¸€æ­¥å¯¹â€œè¶Šå¾€åè¶Šå®¹æ˜“é‡å¤/åå­—â€ç‰¹åˆ«æœ‰æ•ˆã€‚

---

## äº”ã€å¦‚æœä¸ç”¨ Barkï¼Œé‚£â€œæ¢è°â€æ‰æœ‰æ„ä¹‰ï¼Ÿ

### æ›´æœ‰æ„ä¹‰çš„æ›¿ä»£é¡ºåºæ˜¯ï¼š

1ï¸âƒ£ **CosyVoice / CosyVoice FT**

- æ¯” XTTSï¼š
    
    - æ›´å°‘é‡å¤
        
    - æ›´å°‘åå­—
        
    - ä¸­æ–‡æ›´ç¨³
        
- **æœ‰å£°ä¹¦å‹å¥½åº¦æ›´é«˜**
    

2ï¸âƒ£ **IndexTTSï¼ˆtoken-freeï¼‰**

- é‡å¤/åå­—å‡ ä¹æ²¡æœ‰
    
- ä½†ç®—åŠ›è¦æ±‚é«˜
    
- æ›´é€‚åˆâ€œè´¨é‡ä¼˜å…ˆæ®µè½â€
    

ğŸ‘‰ **è€Œ Bark ä¸åœ¨è¿™æ¡å‡çº§è·¯å¾„ä¸Š**ã€‚

---

## å…­ã€ç»™ä½ ä¸€å¥æœ€ç»ˆåˆ¤æ–­ï¼ˆé‡ç‚¹ï¼‰

> å¦‚æœä½ ç°åœ¨ XTTS æœ‰é‡å¤ã€åå­—ï¼š  
> **ä¸è¦æ¢ Bark**  
> **å…ˆæŠŠ XTTS çš„è§£ç å‚æ•° + æ–‡æœ¬åˆ‡åˆ† + reset æœºåˆ¶åšå¥½**

ä½ ç°åœ¨çš„æƒ…å†µï¼Œ**90% å¯ä»¥é€šè¿‡æ­£ç¡®è°ƒå‚è§£å†³**ï¼Œè€Œä¸æ˜¯æ¢æ¨¡å‹ã€‚

---

### å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥ç›´æ¥å¸®ä½ ï¼š

- ğŸ”§ ç»™ä½ ä¸€å¥— **â€œXTTS è‡ªåŠ¨æ£€æµ‹å¹¶é‡è¯•ï¼ˆanti-loopï¼‰â€çš„ç”Ÿæˆé€»è¾‘**
    
- ğŸ§  æˆ–è€… **å¯¹æ¯” CosyVoice vs XTTS åœ¨ä½ åŒä¸€æ®µæ–‡æœ¬ä¸Šçš„ç¨³å®šæ€§ç­–ç•¥**
    
- ğŸ§ª æˆ–è€… **å†™ä¸€ä¸ªâ€œæ£€æµ‹é‡å¤ token â†’ è‡ªåŠ¨å›é€€å‚æ•°â€çš„ wrapper**
    

ä½ åªè¦å‘Šè¯‰æˆ‘ï¼š  
ğŸ‘‰ ä½ ç°åœ¨ XTTS æ˜¯ **Python API è¿˜æ˜¯ CLI è°ƒç”¨**ï¼Ÿ